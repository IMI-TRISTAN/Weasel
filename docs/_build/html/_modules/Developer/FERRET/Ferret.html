

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Developer.FERRET.Ferret &mdash; Weasel 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Weasel
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">Weasel</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Weasel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>Developer.FERRET.Ferret</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for Developer.FERRET.Ferret</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;This module contains the code for the FERRETModel Fitting application. </span>
<span class="sd">It defines the GUI and the logic providing the application&#39;s functionality. </span>
<span class="sd">The GUI was built using PyQT5.</span>

<span class="sd">How to Use.</span>
<span class="sd">-----------</span>
<span class="sd">   The FERRET-Model-Fitting application allows the user to analyse </span>
<span class="sd">   organ time/concentration data by fitting a model to the </span>
<span class="sd">   Region Of Interest (ROI) time/concentration curve. </span>
<span class="sd">   The FERRET-Model-Fitting application provides the following functionality:</span>
<span class="sd">        1. Load an XML configuration file that describes the models to be fitted</span>
<span class="sd">            to the concentration/time data.</span>
<span class="sd">        2. Then load a CSV file of concentration/time or MR Signal/time data.  </span>
<span class="sd">            The first column must contain time data in seconds. </span>
<span class="sd">            remaining columns of data must contain concentration in </span>
<span class="sd">			millimoles (mM) or MR signal data for individual organs </span>
<span class="sd">            at the time points in the time column. </span>
<span class="sd">			There must be at least 2 columns of concentration data.  </span>
<span class="sd">			There is no upper limit on the number of columns of concentration data.</span>
<span class="sd">			Each time a CSV file is loaded, the screen is reset to its initial state.</span>
<span class="sd">        3. Select a Region Of Interest (ROI) and display a plot of its concentration against</span>
<span class="sd">            time.</span>
<span class="sd">        4. The user can then select a model they would like to fit to the ROI data.  </span>
<span class="sd">            When a model is selected, a schematic representation of it may be</span>
<span class="sd">           displayed on the right-hand side of the screen if an image is available.</span>
<span class="sd">           An image file will have to be stored in the images </span>
<span class="sd">           folder in the root folder containing the application </span>
<span class="sd">           source code and its name defined in the XML configuration file.</span>
<span class="sd">        5. Depending on the model selected the user can then select an Arterial Input Function(AIF)</span>
<span class="sd">            and/or a Venous Input Function (VIF) and display a plot(s) of its/their concentration </span>
<span class="sd">            against time on the same axes as the ROI.</span>
<span class="sd">        6. After step 4 is performed, the selected model is used </span>
<span class="sd">           to create a time/concentration series</span>
<span class="sd">           based on default values for the models input parameters.  </span>
<span class="sd">          data series is also plotted on the above axes.</span>
<span class="sd">        7. The default model parameters are displayed on the form </span>
<span class="sd">           and the user may vary them and observe the effect on </span>
<span class="sd">           the curve generated in step 5.</span>
<span class="sd">        8. Clicking the &#39;Reset&#39; button resets the model </span>
<span class="sd">           input parameters to their default values.</span>
<span class="sd">        9. By clicking the &#39;Fit Model&#39; button, the model is </span>
<span class="sd">           fitted to the ROI data and the resulting values </span>
<span class="sd">           of the model input parameters are displayed on </span>
<span class="sd">           the screen together with their 95% confidence limits.</span>
<span class="sd">        10. By clicking the &#39;Save plot data to CSV file&#39; button the data plotted on the screen is saved</span>
<span class="sd">            to a CSV file - one column for each plot and a column for time.</span>
<span class="sd">            A file dialog box is displayed allowing the user to select a location </span>
<span class="sd">            and enter a file name.</span>
<span class="sd">        11. By clicking the &#39;Save Report in PDF Format&#39;, </span>
<span class="sd">            current state of the model fitting session</span>
<span class="sd">            is saved in PDF format.  This includes a image </span>
<span class="sd">            of the plot, name of the model, name of the </span>
<span class="sd">            data file and the values of the model input parameters. </span>
<span class="sd">            If curve fitting has been carried </span>
<span class="sd">            out and the values of the model input parameters </span>
<span class="sd">            have not been manually adjusted, then the report </span>
<span class="sd">            will contain the 95% confidence limits of the </span>
<span class="sd">            model input parameter values arrived at by curve fitting.</span>
<span class="sd">        12. While this application is running, events &amp; function </span>
<span class="sd">            calls with data where appropriate </span>
<span class="sd">            are logged to a file called FERRET.log, </span>
<span class="sd">            stored at the same location as the </span>
<span class="sd">            source code or executable. This file can be used as a debugging aid. </span>
<span class="sd">            When a new instance of the application is started, </span>
<span class="sd">            FERRET.log from the last session will be deleted</span>
<span class="sd">            and a new log file started.</span>
<span class="sd">        13. Clicking the &#39;Start Batch Processing&#39; button applies model fitting</span>
<span class="sd">            to the MR signal/time data in all the files in the folder containing</span>
<span class="sd">            the data file selected in step 2.  For each file, a PDF report is created</span>
<span class="sd">            as in step 11. Also, a Microsoft Excel spread sheet summarising all</span>
<span class="sd">            the results is generated.</span>
<span class="sd">        14. Clicking the &#39;Exit&#39; button closes the application.</span>

<span class="sd">Application Module Structure.</span>
<span class="sd">---------------------------</span>
<span class="sd">The code in FERRET.py defines the GUI and the logic providing </span>
<span class="sd">the application&#39;s functionality.  The GUI was built using PyQT5.</span>

<span class="sd">The FerretXMLReader.py class module uses the xml.etree.ElementTree package to parse</span>
<span class="sd">the XML configuration file that describes all the models to be made available</span>
<span class="sd">for curve fitting.  It also contains functions that query the XML tree using</span>
<span class="sd">XPath notation and return data.</span>

<span class="sd">The styleSheet.py module contains style instructions using CSS </span>
<span class="sd">notation for each control/widget.</span>

<span class="sd">The MathsTools.py module contains a library of mathematical functions </span>
<span class="sd">used to solve the equations in the models in ModelFunctionsHelper.py.</span>

<span class="sd">Objects of the following 2 classes are created in modelFittingGUI.py </span>
<span class="sd">and provide services to this class:</span>
<span class="sd">    1. The PDFWrite.py class module creates and saves a report </span>
<span class="sd">    of a model fitting session in a PDF file.</span>
<span class="sd">    2. The ExcelWriter.py class module uses the openpyxl package </span>
<span class="sd">    to create an Excel spreadsheet and write a summary of the </span>
<span class="sd">    results from the batch processing of data files.</span>

<span class="sd">The ModelFunctions.py class module contains functions that use </span>
<span class="sd">tracer kinetic models to calculate the variation of concentration</span>
<span class="sd">with time according to several tracer kinetic models. </span>

<span class="sd">The ModelFunctionsHelper module coordinates the calling of model </span>
<span class="sd">functions in ModelFunctions.py by functions in ModelFittingGUI.py</span>

<span class="sd">GUI Structure</span>
<span class="sd">--------------</span>
<span class="sd">The GUI is based on the QWidget class.</span>
<span class="sd">The GUI contains a single form.  Controls are arranged in two </span>
<span class="sd">vertical columns on this form using Vertical Layout widgets.</span>
<span class="sd">Consequently, a horizontal layout control in placed on this form. </span>
<span class="sd">Within this horizontal layout are placed 2 vertical layout controls.</span>

<span class="sd">The left-hand side vertical layout holds controls pertaining to the input and </span>
<span class="sd">selection of data and the selection of a model to analyse the data. The results</span>
<span class="sd">of curve fitting, optimum parameter values and their confidence limits</span>
<span class="sd">are displayed next to their parameter input values.</span>

<span class="sd">The right-hand side vertical layout holds controls for the display of a schematic </span>
<span class="sd">representation of the chosen model and a canvas widget for the </span>
<span class="sd">graphical display of the data.</span>

<span class="sd">The appearance of the GUI is controlled by the CSS commands in styleSheet.py</span>

<span class="sd">Reading Data into the Application.</span>
<span class="sd">----------------------------------</span>
<span class="sd">The function LoadModelLibrary loads and parses the contents of the </span>
<span class="sd">XML file that describes the models to be used for curve fitting.  </span>
<span class="sd">If parsing is successful, the XML tree is stored in memory </span>
<span class="sd">and used to build a list of models for display in a combo box on the GUI,</span>
<span class="sd">and the &#39;Load Data File&#39; button is made visible.</span>
<span class="sd">See the README file for a detailed description of the XML configuration file.</span>

<span class="sd">Clicking the &#39;Load Data File&#39; button executes the LoadDataFile function.</span>
<span class="sd">The function LoadDataFile loads the contents of a CSV file</span>
<span class="sd">containing time and MR signal data into a dictionary of lists.</span>
<span class="sd">The key is the name of the organ or &#39;time&#39; and the </span>
<span class="sd">corresponding value is a list of MR signals for that organ</span>
<span class="sd">(or times when the key is &#39;time&#39;).  </span>
<span class="sd">The header label of each column of data is taken as a key.  </span>
<span class="sd">        </span>
<span class="sd">The following validation is applied to the data file:</span>
<span class="sd">    -The CSV file must contain at least 3 columns of data separated by commas.</span>
<span class="sd">    -The first column in the CSV file must contain time data.</span>
<span class="sd">    -The header of the time column must contain the word &#39;time&#39;.</span>

<span class="sd">A list of keys is created and displayed in drop down lists to provide a means </span>
<span class="sd">of selecting the Region of Interest (ROI), Arterial Input Function (AIF) and</span>
<span class="sd">the Venous Input Function (VIF).</span>

<span class="sd">As the time data is read, it is divided by 60 in order to convert it into minutes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Steve Shillitoe, https://www.imagingbiomarkers.org/stephen-shillitoe&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;Date: 2018/12/12&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c1">#Add folders CoreModules &amp; Developer/ModelLibrary to the Module Search Path. </span>
<span class="c1">#path[0] is the current working directory</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;CoreModules//FERRET//&#39;</span><span class="p">))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;Developer//FERRET//FERRET_Files//ModelLibrary//&#39;</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="n">QCursor</span><span class="p">,</span> <span class="n">QIcon</span><span class="p">,</span> <span class="n">QPixmap</span><span class="p">,</span> <span class="n">QImage</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtCore</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QDoubleSpinBox</span><span class="p">,</span>\
     <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span> <span class="n">QGroupBox</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span>  \
     <span class="n">QMessageBox</span><span class="p">,</span> <span class="n">QFileDialog</span><span class="p">,</span> <span class="n">QCheckBox</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="p">,</span> <span class="n">QSpacerItem</span><span class="p">,</span> \
     <span class="n">QGridLayout</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QStatusBar</span><span class="p">,</span> <span class="n">QProgressBar</span><span class="p">,</span> <span class="n">QFrame</span>

<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt5agg</span> <span class="kn">import</span> <span class="n">FigureCanvasQTAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt5agg</span> <span class="kn">import</span> <span class="n">NavigationToolbar2QT</span> <span class="k">as</span> <span class="n">NavigationToolbar</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">scipy.stats.distributions</span> <span class="kn">import</span>  <span class="n">t</span>

<span class="kn">import</span> <span class="nn">CoreModules.FERRET.ModelFunctionsHelper</span> <span class="k">as</span> <span class="nn">ModelFunctionsHelper</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;CoreModules&#39;</span><span class="p">))</span>

<span class="c1">#Import PDF report writer class</span>
<span class="kn">from</span> <span class="nn">CoreModules.FERRET.PDFWriter</span> <span class="kn">import</span> <span class="n">PDF</span>

<span class="kn">from</span> <span class="nn">CoreModules.FERRET.ExcelWriter</span> <span class="kn">import</span> <span class="n">ExcelWriter</span>

<span class="kn">from</span> <span class="nn">CoreModules.FERRET.ferretXMLReader</span> <span class="kn">import</span> <span class="n">FerretXMLReader</span>

 
<span class="c1">########################################</span>
<span class="c1">##              CONSTANTS             ##</span>
<span class="c1">########################################</span>
<span class="n">WINDOW_TITLE</span> <span class="o">=</span> <span class="s1">&#39;FERRET - Model-fitting of dynamic contrast-enhanced MRI&#39;</span>
<span class="n">REPORT_TITLE</span> <span class="o">=</span> <span class="s1">&#39;FERRET - Model-fitting of dynamic contrast-enhanced MRI&#39;</span>
<span class="n">IMAGE_NAME</span> <span class="o">=</span> <span class="s1">&#39;model.png&#39;</span>
<span class="n">DEFAULT_REPORT_FILE_PATH_NAME</span> <span class="o">=</span> <span class="s1">&#39;report.pdf&#39;</span>
<span class="n">DEFAULT_PLOT_DATA_FILE_PATH_NAME</span> <span class="o">=</span> <span class="s1">&#39;plot.csv&#39;</span>
<span class="n">MIN_NUM_COLUMNS_CSV_FILE</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1">#Path to model library XML files folder</span>
<span class="n">defaultPathModelLibrary</span> <span class="o">=</span> <span class="s2">&quot;Developer</span><span class="se">\\</span><span class="s2">FERRET</span><span class="se">\\</span><span class="s2">FERRET_Files</span><span class="se">\\</span><span class="s2">ModelConfiguration</span><span class="se">\\</span><span class="s2">&quot;</span>

<span class="c1">#Image Files</span>
<span class="n">TRISTAN_LOGO</span> <span class="o">=</span> <span class="s1">&#39;images</span><span class="se">\\</span><span class="s1">TRISTAN LOGO.jpg&#39;</span>
<span class="n">LARGE_TRISTAN_LOGO</span> <span class="o">=</span><span class="s1">&#39;images</span><span class="se">\\</span><span class="s1">logo-tristan.png&#39;</span>
<span class="n">UNI_OF_LEEDS_LOGO</span> <span class="o">=</span><span class="s1">&#39;images</span><span class="se">\\</span><span class="s1">uni-leeds-logo.jpg&#39;</span>
<span class="n">FERRET_LOGO</span> <span class="o">=</span> <span class="s1">&#39;images</span><span class="se">\\</span><span class="s1">FERRET_LOGO.png&#39;</span>
<span class="n">MODEL_DIAGRAM_FOLDER</span> <span class="o">=</span> <span class="s1">&#39;Developer</span><span class="se">\\</span><span class="s1">FERRET</span><span class="se">\\</span><span class="s1">FERRET_Files</span><span class="se">\\</span><span class="s1">ModelDiagrams</span><span class="se">\\</span><span class="s1">&#39;</span>
<span class="c1">#######################################</span>

<span class="c1">#Create and configure the logger</span>
<span class="c1">#First delete the previous log file if there is one</span>
<span class="n">LOG_FILE_NAME</span> <span class="o">=</span> <span class="s2">&quot;WEASEL.log&quot;</span>
<span class="n">LOG_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">LOG_FILE_NAME</span><span class="p">,</span> 
                    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> 
                    <span class="nb">format</span><span class="o">=</span><span class="n">LOG_FORMAT</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<div class="viewcode-block" id="NavigationToolbar"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.NavigationToolbar">[docs]</a><span class="k">class</span> <span class="nc">NavigationToolbar</span><span class="p">(</span><span class="n">NavigationToolbar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes unwanted default buttons in the Navigation Toolbar by creating</span>
<span class="sd">    a subclass of the NavigationToolbar class from from </span>
<span class="sd">    matplotlib.backends.backend_qt5agg import NavigationToolbar2QT as NavigationToolbar</span>
<span class="sd">    that only defines the desired buttons</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">toolitems</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">NavigationToolbar</span><span class="o">.</span><span class="n">toolitems</span> <span class="k">if</span>
                 <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Home&#39;</span><span class="p">,</span> <span class="s1">&#39;Pan&#39;</span><span class="p">,</span> <span class="s1">&#39;Zoom&#39;</span><span class="p">,</span> <span class="s1">&#39;Save&#39;</span><span class="p">)]</span></div>


<span class="c1"># User-defined exceptions</span>
<div class="viewcode-block" id="Error"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Error">[docs]</a><span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;Base class for other exceptions&quot;&quot;&quot;</span>
   <span class="k">pass</span></div>

<div class="viewcode-block" id="NoModelFunctionDefined"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.NoModelFunctionDefined">[docs]</a><span class="k">class</span> <span class="nc">NoModelFunctionDefined</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;Raised when the name of the function corresponding </span>
<span class="sd">   to a model is not returned from the XML configuration file.&quot;&quot;&quot;</span>
   <span class="k">pass</span></div>

<div class="viewcode-block" id="NoModuleDefined"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.NoModuleDefined">[docs]</a><span class="k">class</span> <span class="nc">NoModuleDefined</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;Raised when the name of the module containing the function corresponding </span>
<span class="sd">   to a model is not returned from the XML configuration file.&quot;&quot;&quot;</span>
   <span class="k">pass</span></div>

<div class="viewcode-block" id="NoModelInletTypeDefined"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.NoModelInletTypeDefined">[docs]</a><span class="k">class</span> <span class="nc">NoModelInletTypeDefined</span><span class="p">(</span><span class="n">Error</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;Raised when the inlet type of the model is not returned</span>
<span class="sd">    from the XML configuration file.&quot;&quot;&quot;</span>
   <span class="k">pass</span></div>

<div class="viewcode-block" id="Ferret"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret">[docs]</a><span class="k">class</span> <span class="nc">Ferret</span><span class="p">:</span>   
    <span class="sd">&quot;&quot;&quot;This class defines the FERRET Model Fitting software </span>
<span class="sd">       based on the QWidget class that provides the GUI.</span>
<span class="sd">       This includes seting up the GUI and defining the methods </span>
<span class="sd">       that are executed when events associated with widgets on</span>
<span class="sd">       the GUI are executed.&quot;&quot;&quot;</span>
     
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thisWindow</span><span class="p">,</span> <span class="n">statusBar</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates the GUI. Controls on the GUI are placed onto 2 vertical</span>
<span class="sd">           layout panals placed on a horizontal layout panal.</span>
<span class="sd">           The horizontal layout panal is contained by a QWidget object</span>
<span class="sd">           that is returned to the MDI subwindow hosting FERRET, where</span>
<span class="sd">           it is displayed.</span>
<span class="sd">           The appearance of the widgets is determined by CSS </span>
<span class="sd">           commands in the module styleSheet.py. </span>
<span class="sd">           </span>
<span class="sd">           The left-handside vertical layout panal holds widgets for the </span>
<span class="sd">           input of data &amp; the selection of the model to fit to the data.</span>
<span class="sd">           Optimum parameter data and their confidence limits resulting</span>
<span class="sd">           from the model fit are also displayed.</span>
<span class="sd">           </span>
<span class="sd">           The right-handside vertical layout panal holds the graph </span>
<span class="sd">           displaying the time/concentration data and the fitted model.</span>
<span class="sd">           Above this graph is displayed a schematic representation of the</span>
<span class="sd">           model.</span>
<span class="sd">           </span>
<span class="sd">           This method coordinates the calling of methods that set up the </span>
<span class="sd">           widgets on the 2 vertical layout panals.</span>

<span class="sd">           Input parameters</span>
<span class="sd">           ------------------------------------</span>
<span class="sd">           thisWindow - object reference to the MDI subwindow used to</span>
<span class="sd">           display FERRET</span>

<span class="sd">           statusBar - object reference to the status bar on the MDI</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thisWindow</span> <span class="o">=</span> <span class="n">thisWindow</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span> <span class="o">=</span> <span class="n">statusBar</span>

            <span class="c1"># Store path to time/concentration data files for use </span>
            <span class="c1"># in batch processing.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataFileDirectory</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
            <span class="c1"># Name of current loaded data file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">yAxisLabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># Boolean variable indicating that the last </span>
            <span class="c1"># change to the model parameters was caused</span>
            <span class="c1"># by curve fitting.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isCurveFittingDone</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Dictionary to store signal data from the data input file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="o">=</span><span class="p">{}</span> 

            <span class="c1"># List to store concentrations calculated by the models</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listModel</span> <span class="o">=</span> <span class="p">[]</span> 
        
            <span class="c1"># Stores optimum parameters from Curve fitting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span> <span class="o">=</span> <span class="p">[]</span> 
        
            <span class="c1"># XML reader object to process XML configuration file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span> <span class="o">=</span> <span class="n">FerretXMLReader</span><span class="p">()</span> 
       
            <span class="c1"># Setup the layouts, the containers for widgets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainWidget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainWidget</span><span class="p">,</span> \
            <span class="n">verticalLayoutLeft</span><span class="p">,</span> \
            <span class="n">verticalLayoutRight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetUpLayouts</span><span class="p">()</span> 
        
            <span class="c1"># Add widgets to the left-hand side vertical layout</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetUpLeftVerticalLayout</span><span class="p">(</span><span class="n">verticalLayoutLeft</span><span class="p">)</span>

            <span class="c1"># Set up the graph to plot concentration data on</span>
            <span class="c1">#  the right-hand side vertical layout</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetUpPlotArea</span><span class="p">(</span><span class="n">verticalLayoutRight</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;FERRET GUI created successfully.&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error creating FERRET object: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> 
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error creating FERRET object: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>


<div class="viewcode-block" id="Ferret.returnFerretWidget"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.returnFerretWidget">[docs]</a>    <span class="k">def</span> <span class="nf">returnFerretWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method returns the QWidget object containing the FERRET </span>
<span class="sd">        GUI.  It is called when the MDI subwindow hosting FERRET is</span>
<span class="sd">        created.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainWidget</span></div>


<div class="viewcode-block" id="Ferret.SetUpLayouts"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.SetUpLayouts">[docs]</a>    <span class="k">def</span> <span class="nf">SetUpLayouts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Places a horizontal layout on the window</span>
<span class="sd">           and places 2 vertical layouts on the horizontal layout.</span>
<span class="sd">           </span>
<span class="sd">           Returns the 2 vertical layouts to be used by other methods</span>
<span class="sd">           that place widgets on them.</span>
<span class="sd">           </span>
<span class="sd">           Returns</span>
<span class="sd">           -------</span>
<span class="sd">                Two vertical layouts that have been added to a </span>
<span class="sd">                horizontal layout.</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="n">horizontalLayout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>

        <span class="n">widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">horizontalLayout</span><span class="p">)</span>

        <span class="n">verticalLayoutLeft</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">verticalLayoutRight</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        
        <span class="n">horizontalLayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">verticalLayoutLeft</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
        <span class="n">horizontalLayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">verticalLayoutRight</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">widget</span><span class="p">,</span> <span class="n">verticalLayoutLeft</span><span class="p">,</span>  <span class="n">verticalLayoutRight</span>  </div>


<div class="viewcode-block" id="Ferret.SetUpLeftVerticalLayout"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.SetUpLeftVerticalLayout">[docs]</a>    <span class="k">def</span> <span class="nf">SetUpLeftVerticalLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates widgets and places them on the left-handside vertical layout. </span>

<span class="sd">        Inputs</span>
<span class="sd">        ------</span>
<span class="sd">        layout - holds a reference to the left handside vertical layout widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create Load Configuration XML file Button</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnLoadModelLibrary</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Load Model Library&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnLoadModelLibrary</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s1">&#39;Opens file dialog box to select the model library file&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnLoadModelLibrary</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="s2">&quot;Ctrl+C&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnLoadModelLibrary</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnLoadModelLibrary</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LoadModelLibrary</span><span class="p">)</span>

            <span class="c1"># Create Load Data File Button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnLoadDataFile</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Load Data File&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnLoadDataFile</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnLoadDataFile</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Opens file dialog box to select the data file&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnLoadDataFile</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="s2">&quot;Ctrl+L&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnLoadDataFile</span><span class="o">.</span><span class="n">setAutoDefault</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnLoadDataFile</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnLoadDataFile</span><span class="o">.</span><span class="n">minimumSizeHint</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnLoadDataFile</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LoadDataFile</span><span class="p">)</span>
        
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnLoadModelLibrary</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnLoadDataFile</span><span class="p">)</span>
         
            <span class="c1"># Create dropdown list &amp; label for selection of ROI</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblROI</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Region of Interest:&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblROI</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Select Region of Interest&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblROI</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        
            <span class="c1"># Below Load Data button add ROI list.  It is placed in a </span>
            <span class="c1"># horizontal layout together with its label, so they are</span>
            <span class="c1"># aligned in the same row.</span>
            <span class="n">ROI_HorizontalLayout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">ROI_HorizontalLayout</span><span class="o">.</span><span class="n">insertStretch</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">ROI_HorizontalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblROI</span><span class="p">)</span>
            <span class="n">ROI_HorizontalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">ROI_HorizontalLayout</span><span class="p">)</span>
        
            <span class="c1"># Create a group box to group together widgets associated with</span>
            <span class="c1"># the model selected. </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetUpModelGroupBox</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveReport</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Save Report in PDF Format&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveReport</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveReport</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s1">&#39;Insert an image of the graph opposite and associated data in a PDF file&#39;</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnSaveReport</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignTop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveReport</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CreatePDFReport</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SetUpBatchProcessingGroupBox</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
        
            <span class="n">layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnClose</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Close&#39;</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnClose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnClose</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closeWindow</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in FERRET.setUpLeftVerticalLayout: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> 
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in FERRET.setUpLeftVerticalLayout: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.SetUpModelGroupBox"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.SetUpModelGroupBox">[docs]</a>    <span class="k">def</span> <span class="nf">SetUpModelGroupBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a group box to hold widgets associated with the </span>
<span class="sd">        selection of a model and for inputing/displaying that model&#39;s</span>
<span class="sd">        parameter data.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxModel</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Model Fitting&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxModel</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignHCenter</span><span class="p">)</span>
            <span class="c1"># The group box is hidden until a ROI is selected.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxModel</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupBoxModel</span><span class="p">)</span>
        
            <span class="c1"># Create horizontal layouts, one row of widgets to </span>
            <span class="c1"># each horizontal layout. Then add them to a vertical layout, </span>
            <span class="c1"># then add the vertical layout to the group box</span>
            <span class="n">modelHorizontalLayoutModelList</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">modelHorizontalLayoutAIF</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">modelHorizontalLayoutVIF</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">modelHorizontalLayoutReset</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">()</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">setColumnStretch</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">modelHorizontalLayoutFitModelBtn</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">modelHorizontalLayoutSaveCSVBtn</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">modelVerticalLayout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
            <span class="n">modelVerticalLayout</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignTop</span><span class="p">)</span> 
            <span class="n">modelVerticalLayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">modelHorizontalLayoutModelList</span><span class="p">)</span>
            <span class="n">modelVerticalLayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">modelHorizontalLayoutAIF</span><span class="p">)</span>
            <span class="n">modelVerticalLayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">modelHorizontalLayoutVIF</span><span class="p">)</span>
            <span class="n">modelVerticalLayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">modelHorizontalLayoutReset</span><span class="p">)</span>
            <span class="n">modelVerticalLayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
            <span class="n">modelVerticalLayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">modelHorizontalLayoutFitModelBtn</span><span class="p">)</span>
            <span class="n">modelVerticalLayout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">modelHorizontalLayoutSaveCSVBtn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxModel</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">modelVerticalLayout</span><span class="p">)</span>
        
            <span class="c1"># Create dropdown list to hold names of models</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modelLabel</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Model:&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modelLabel</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Select a model to fit to the data&#39;</span><span class="p">)</span>
            <span class="c1">#Display first item in list, the string &quot;Select a Model&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UncheckFixParameterCheckBoxes</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DisplayModelImage</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ConfigureGUIForEachModel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">clearOptimisedParamaterList</span><span class="p">(</span><span class="s1">&#39;cmbModels&#39;</span><span class="p">))</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display_FitModel_SaveCSV_SaveReport_Buttons</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">plotMRSignals</span><span class="p">(</span><span class="s1">&#39;cmbModels&#39;</span><span class="p">))</span>

            <span class="c1"># Create dropdown lists for selection of AIF &amp; VIF</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblAIF</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Arterial Input Function:&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Select Arterial Input Function&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblVIF</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Venous Input Function:&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Select Venous Input Function&#39;</span><span class="p">)</span>

            <span class="c1"># When a ROI is selected: </span>
            <span class="c1"># plot its concentration data on the graph.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">plotMRSignals</span><span class="p">(</span><span class="s1">&#39;cmbROI&#39;</span><span class="p">))</span>
            <span class="c1"># then make the Model groupbox and the widgets it contains visible.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DisplayModelFittingGroupBox</span><span class="p">)</span>
            <span class="c1"># When an AIF is selected plot its concentration data on the graph.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotMRSignals</span><span class="p">(</span><span class="s1">&#39;cmbAIF&#39;</span><span class="p">))</span>
            <span class="c1"># When an AIF is selected display the Fit Model and Save plot CVS buttons.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display_FitModel_SaveCSV_SaveReport_Buttons</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display_FitModel_SaveCSV_SaveReport_Buttons</span><span class="p">)</span>
            <span class="c1"># When a VIF is selected plot its concentration data on the graph.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotMRSignals</span><span class="p">(</span><span class="s1">&#39;cmbVIF&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblAIF</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblVIF</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">setSizeAdjustPolicy</span><span class="p">(</span><span class="n">QComboBox</span><span class="o">.</span><span class="n">AdjustToContents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">setSizeAdjustPolicy</span><span class="p">(</span><span class="n">QComboBox</span><span class="o">.</span><span class="n">AdjustToContents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">setSizeAdjustPolicy</span><span class="p">(</span><span class="n">QComboBox</span><span class="o">.</span><span class="n">AdjustToContents</span><span class="p">)</span>
        
            <span class="c1"># Add combo boxes and their labels to the horizontal layouts</span>
            <span class="n">modelHorizontalLayoutModelList</span><span class="o">.</span><span class="n">insertStretch</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">modelHorizontalLayoutModelList</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelLabel</span><span class="p">)</span>
            <span class="n">modelHorizontalLayoutModelList</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="p">)</span>
            <span class="n">modelHorizontalLayoutAIF</span><span class="o">.</span><span class="n">insertStretch</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">modelHorizontalLayoutAIF</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblAIF</span><span class="p">)</span>
            <span class="n">modelHorizontalLayoutAIF</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="p">)</span>
            <span class="n">modelHorizontalLayoutVIF</span><span class="o">.</span><span class="n">insertStretch</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">modelHorizontalLayoutVIF</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblVIF</span><span class="p">)</span>
            <span class="n">modelHorizontalLayoutVIF</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="p">)</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">cboxDelay</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span> <span class="s1">&#39;Delay&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cboxConstaint</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Constraint&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cboxDelay</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cboxConstaint</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnReset</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Reset&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnReset</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Reset parameters to their default values.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnReset</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnReset</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">InitialiseParameterSpinBoxes</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnReset</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OptimumParameterChanged</span><span class="p">)</span>
            <span class="c1"># If parameters reset to their default values, </span>
            <span class="c1"># replot the concentration and model data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnReset</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotMRSignals</span><span class="p">(</span><span class="s1">&#39;Reset Button&#39;</span><span class="p">))</span>
            <span class="n">modelHorizontalLayoutReset</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cboxDelay</span><span class="p">)</span>
            <span class="n">modelHorizontalLayoutReset</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cboxConstaint</span><span class="p">)</span>
            <span class="n">modelHorizontalLayoutReset</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnReset</span><span class="p">)</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">lblPhysParams</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&lt;u&gt;Model Parameters&lt;/u&gt;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblConfInt</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&lt;u&gt;95% Conf&#39; Interval&lt;/u&gt;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblFix</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&lt;u&gt;Fix&lt;/u&gt;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblPhysParams</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblFix</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblConfInt</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblPhysParams</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignLeft</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblConfInt</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblFix</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignLeft</span><span class="p">)</span>

            <span class="c1"># Create model parameter spinboxes and their labels</span>
            <span class="c1"># Label text set when the model is selected</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labelParameter1</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">labelParameter1</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter1</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter1</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblParam1ConfInt</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblParam1ConfInt</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">labelParameter2</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter2</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter2</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblParam2ConfInt</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblParam2ConfInt</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">labelParameter3</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter3</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter3</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblParam3ConfInt</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblParam3ConfInt</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">labelParameter4</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter4</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter4</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblParam4ConfInt</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblParam4ConfInt</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">labelParameter5</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter5</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter5</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblParam5ConfInt</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblParam5ConfInt</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter1</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter2</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter3</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter4</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter5</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">()</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter1</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter2</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter3</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter4</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter5</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

            <span class="c1"># If a parameter value is changed, replot the concentration and model data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter1</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotMRSignals</span><span class="p">(</span><span class="s1">&#39;spinBoxParameter1&#39;</span><span class="p">))</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter2</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotMRSignals</span><span class="p">(</span><span class="s1">&#39;spinBoxParameter2&#39;</span><span class="p">))</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter3</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotMRSignals</span><span class="p">(</span><span class="s1">&#39;spinBoxParameter3&#39;</span><span class="p">))</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter4</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotMRSignals</span><span class="p">(</span><span class="s1">&#39;spinBoxParameter4&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter5</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotMRSignals</span><span class="p">(</span><span class="s1">&#39;spinBoxParameter5&#39;</span><span class="p">))</span>
            <span class="c1"># Set boolean variable, self.isCurveFittingDone to false to </span>
            <span class="c1"># indicate that the value of a model parameter</span>
            <span class="c1"># has been changed manually rather than by curve fitting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter1</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OptimumParameterChanged</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter2</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OptimumParameterChanged</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter3</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OptimumParameterChanged</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter4</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OptimumParameterChanged</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter5</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OptimumParameterChanged</span><span class="p">)</span>

            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblPhysParams</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignLeft</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblFix</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblConfInt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labelParameter1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblParam1ConfInt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
       
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labelParameter2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblParam2ConfInt</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>

            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labelParameter3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblParam3ConfInt</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>

            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labelParameter4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblParam4ConfInt</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>

            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labelParameter5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblParam5ConfInt</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">btnFitModel</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Fit Model&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnFitModel</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Use non-linear least squares to fit the selected model to the data&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnFitModel</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="n">modelHorizontalLayoutFitModelBtn</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnFitModel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnFitModel</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CurveFit</span><span class="p">)</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveCSV</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Save plot data to CSV file&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveCSV</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Save the data plotted on the graph to a CSV file&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveCSV</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="n">modelHorizontalLayoutSaveCSVBtn</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnSaveCSV</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveCSV</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SaveCSVFile</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in FERRET.SetUpModelGroupBox: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> 
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in FERRET.SetUpModelGroupBox: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.SetUpBatchProcessingGroupBox"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.SetUpBatchProcessingGroupBox">[docs]</a>    <span class="k">def</span> <span class="nf">SetUpBatchProcessingGroupBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a group box to hold widgets associated with batch</span>
<span class="sd">        processing functionality.</span>
<span class="sd">        </span>
<span class="sd">        Inputs</span>
<span class="sd">        ------</span>
<span class="sd">        layout - holds a reference to the left handside vertical layout widget</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxBatchProcessing</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="s1">&#39;Batch Processing&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxBatchProcessing</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignHCenter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxBatchProcessing</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupBoxBatchProcessing</span><span class="p">)</span>

            <span class="n">verticalLayout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxBatchProcessing</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">verticalLayout</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">btnBatchProc</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Start Batch Processing&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnBatchProc</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Processes all the CSV data files in the selected directory&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnBatchProc</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BatchProcessAllCSVDataFiles</span><span class="p">)</span> 
            <span class="n">verticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnBatchProc</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lblBatchProcessing</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblBatchProcessing</span><span class="o">.</span><span class="n">setWordWrap</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">verticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblBatchProcessing</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pbar</span> <span class="o">=</span> <span class="n">QProgressBar</span><span class="p">()</span>
            <span class="n">verticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pbar</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pbar</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in FERRET.SetUpBatchProcessingGroupBox: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> 
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in FERRET.SetUpBatchProcessingGroupBox: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>
        

<div class="viewcode-block" id="Ferret.DisplayModelFittingGroupBox"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.DisplayModelFittingGroupBox">[docs]</a>    <span class="k">def</span> <span class="nf">DisplayModelFittingGroupBox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shows the model fitting group box if a ROI is selected. </span>
<span class="sd">        Otherwise hides the model fitting group box. &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ROI</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">ROI</span> <span class="o">!=</span> <span class="s1">&#39;Please Select&#39;</span><span class="p">:</span>
                <span class="c1"># A ROI has been selected</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxModel</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveReport</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Function FERRET.DisplayModelFittingGroupBox called. Model group box and Save Report button shown when ROI = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ROI</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxModel</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveReport</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Function FERRET.DisplayModelFittingGroupBox called. Model group box and Save Report button hidden.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.DisplayModelFittingGroupBox: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> 
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.DisplayModelFittingGroupBox: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.SetUpPlotArea"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.SetUpPlotArea">[docs]</a>    <span class="k">def</span> <span class="nf">SetUpPlotArea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds widgets for the display of the graph onto the </span>
<span class="sd">        right-hand side vertical layout.</span>
<span class="sd">        </span>
<span class="sd">        Inputs</span>
<span class="sd">        ------</span>
<span class="sd">        layout - holds a pointer to the right-hand side vertical layout widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignTop</span><span class="p">)</span>

        <span class="c1"># lblModelImage is used to display a schematic</span>
        <span class="c1"># representation of the model.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblModelImage</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">lblModelImage</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblModelImage</span><span class="o">.</span><span class="n">setMargin</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                                        
            <span class="bp">self</span><span class="o">.</span><span class="n">lblModelName</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblModelName</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblModelName</span><span class="o">.</span><span class="n">setMargin</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblModelName</span><span class="o">.</span><span class="n">setFrameStyle</span><span class="p">(</span><span class="n">QFrame</span><span class="o">.</span><span class="n">Panel</span> <span class="o">|</span> <span class="n">QFrame</span><span class="o">.</span><span class="n">Sunken</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblModelName</span><span class="o">.</span><span class="n">setWordWrap</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span> 
            <span class="c1"># this is the Canvas Widget that displays the `figure`</span>
            <span class="c1"># it takes the `figure` instance as a parameter </span>
            <span class="c1"># to its __init__ function</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">FigureCanvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
        
            <span class="c1"># this is the Navigation widget</span>
            <span class="c1"># it takes the Canvas widget as a parent</span>
            <span class="c1">#self.toolbar = NavigationToolbar(self.canvas, self)</span>
            <span class="n">toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisWindow</span><span class="p">)</span>

            <span class="c1"># Display TRISTAN &amp; University of Leeds Logos in labels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblFERRET_Logo</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblTRISTAN_Logo</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblUoL_Logo</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblTRISTAN_Logo</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignHCenter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblUoL_Logo</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignHCenter</span><span class="p">)</span>

            <span class="n">pixmapFERRET</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="p">(</span><span class="n">FERRET_LOGO</span><span class="p">)</span>
            <span class="n">pMapWidth</span> <span class="o">=</span> <span class="n">pixmapFERRET</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> 
            <span class="n">pMapHeight</span> <span class="o">=</span> <span class="n">pixmapFERRET</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> 
            <span class="n">pixmapFERRET</span> <span class="o">=</span> <span class="n">pixmapFERRET</span><span class="o">.</span><span class="n">scaled</span><span class="p">(</span><span class="n">pMapWidth</span><span class="p">,</span> <span class="n">pMapHeight</span><span class="p">,</span> 
                          <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">KeepAspectRatio</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">SmoothTransformation</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblFERRET_Logo</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixmapFERRET</span><span class="p">)</span> 

            <span class="n">pixmapTRISTAN</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="p">(</span><span class="n">LARGE_TRISTAN_LOGO</span><span class="p">)</span>
            <span class="n">pMapWidth</span> <span class="o">=</span> <span class="n">pixmapTRISTAN</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">pMapHeight</span> <span class="o">=</span> <span class="n">pixmapTRISTAN</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">pixmapTRISTAN</span> <span class="o">=</span> <span class="n">pixmapTRISTAN</span><span class="o">.</span><span class="n">scaled</span><span class="p">(</span><span class="n">pMapWidth</span><span class="p">,</span> <span class="n">pMapHeight</span><span class="p">,</span> 
                          <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">KeepAspectRatio</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">SmoothTransformation</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblTRISTAN_Logo</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixmapTRISTAN</span><span class="p">)</span>

            <span class="n">pixmapUoL</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="p">(</span><span class="n">UNI_OF_LEEDS_LOGO</span><span class="p">)</span>
            <span class="n">pMapWidth</span> <span class="o">=</span> <span class="n">pixmapUoL</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.75</span>
            <span class="n">pMapHeight</span> <span class="o">=</span> <span class="n">pixmapUoL</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.75</span>
            <span class="n">pixmapUoL</span> <span class="o">=</span> <span class="n">pixmapUoL</span><span class="o">.</span><span class="n">scaled</span><span class="p">(</span><span class="n">pMapWidth</span><span class="p">,</span> <span class="n">pMapHeight</span><span class="p">,</span> 
                          <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">KeepAspectRatio</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">SmoothTransformation</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblUoL_Logo</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixmapUoL</span><span class="p">)</span>
       
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblModelImage</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblModelName</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">toolbar</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
            <span class="c1"># Create horizontal layout box to hold TRISTAN &amp; University of Leeds Logos</span>
            <span class="n">horizontalLogoLayout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">horizontalLogoLayout</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
            <span class="c1"># Add horizontal layout to bottom of the vertical layout</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">horizontalLogoLayout</span><span class="p">)</span>
            <span class="c1"># Add labels displaying logos to the horizontal layout, </span>
            <span class="c1"># Tristan on the LHS, UoL on the RHS</span>
            <span class="n">horizontalLogoLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblFERRET_Logo</span><span class="p">)</span>
            <span class="n">horizontalLogoLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblTRISTAN_Logo</span><span class="p">)</span>
            <span class="n">horizontalLogoLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lblUoL_Logo</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in FERRET.setUpPlotArea: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> 
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in FERRET.setUpPlotArea: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.DisplayModelImage"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.DisplayModelImage">[docs]</a>    <span class="k">def</span> <span class="nf">DisplayModelImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method takes the name of the model from the </span>
<span class="sd">            drop-down list on the left-hand side of the GUI </span>
<span class="sd">            and displays the corresponding image depicting </span>
<span class="sd">            the model and the full name of the model at the</span>
<span class="sd">            top of the right-hand side of the GUI.</span>
<span class="sd">            </span>
<span class="sd">            Both the name of the image file and the full name</span>
<span class="sd">            of the model are retrieved from the XML configuration</span>
<span class="sd">            file.</span>

<span class="sd">            If no image is defined for the model in the XML configuration</span>
<span class="sd">            file, then the string &#39;No image available for this model&#39; is </span>
<span class="sd">            displayed on the GUI.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Function FERRET.DisplayModelImage called.&#39;</span><span class="p">)</span>
            <span class="n">shortModelName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        
            <span class="k">if</span> <span class="n">shortModelName</span> <span class="o">!=</span> <span class="s1">&#39;Select a model&#39;</span><span class="p">:</span>
                <span class="c1"># A model has been selected</span>
                <span class="n">imageName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getImageName</span><span class="p">(</span><span class="n">shortModelName</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">imageName</span><span class="p">:</span>
                    <span class="n">imagePath</span> <span class="o">=</span> <span class="n">MODEL_DIAGRAM_FOLDER</span> <span class="o">+</span> <span class="n">imageName</span>
                    <span class="n">pixmapModelImage</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>
                    <span class="c1"># Increase the size of the model image</span>
                    <span class="n">pMapWidth</span> <span class="o">=</span> <span class="n">pixmapModelImage</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.0</span>
                    <span class="n">pMapHeight</span> <span class="o">=</span> <span class="n">pixmapModelImage</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.0</span>
                    <span class="n">pixmapModelImage</span> <span class="o">=</span> <span class="n">pixmapModelImage</span><span class="o">.</span><span class="n">scaled</span><span class="p">(</span><span class="n">pMapWidth</span><span class="p">,</span> <span class="n">pMapHeight</span><span class="p">,</span> 
                          <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">KeepAspectRatio</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">SmoothTransformation</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lblModelImage</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixmapModelImage</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Image </span><span class="si">{}</span><span class="s1"> displayed.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">imageName</span><span class="p">))</span>
                    <span class="n">longModelName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getLongModelName</span><span class="p">(</span><span class="n">shortModelName</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lblModelName</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">longModelName</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lblFERRET_Logo</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lblTRISTAN_Logo</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lblUoL_Logo</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Function FERRET.DisplayModelImage - No image available for this model&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lblModelImage</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lblModelName</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;No image available for this model&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lblModelImage</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lblModelName</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lblFERRET_Logo</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lblTRISTAN_Logo</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lblUoL_Logo</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.DisplayModelImage: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> 
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.DisplayModelImage: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>  </div>


<div class="viewcode-block" id="Ferret.OptimumParameterChanged"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.OptimumParameterChanged">[docs]</a>    <span class="k">def</span> <span class="nf">OptimumParameterChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets boolean self.isCurveFittingDone to false if the </span>
<span class="sd">        plot of the model curve is changed by manually changing the values of </span>
<span class="sd">        model input parameters rather than by running curve fitting.</span>
<span class="sd">        </span>
<span class="sd">        Also, clears the labels that display the optimum value of each </span>
<span class="sd">        parameter and its confidence inteval.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">isCurveFittingDone</span><span class="o">=</span><span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearOptimisedParamaterList</span><span class="p">(</span><span class="s1">&#39;Function-OptimumParameterChanged&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ferret.CurveFitSetConfIntLabel"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.CurveFitSetConfIntLabel">[docs]</a>    <span class="k">def</span> <span class="nf">CurveFitSetConfIntLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called by the CurveFitProcessOptimumParameters function,</span>
<span class="sd">        this function populates the label that displays the </span>
<span class="sd">        upper and lower confidence limits for each calculated </span>
<span class="sd">        optimum parameter value.</span>

<span class="sd">        Where necessary decimal fractions are converted to % and the</span>
<span class="sd">        corresponding value in the global list self.optimisedParamaterList</span>
<span class="sd">        is updated, which is also the source of this data.</span>

<span class="sd">        Upto 5 model input parameters can be displayed on the GUI.  </span>
<span class="sd">        For each parameter there is a spinbox displaying its value,</span>
<span class="sd">        a checkbox to indicate if this parameter should have its </span>
<span class="sd">        value remain fixed during curve fitting and a label to display</span>
<span class="sd">        the upper and lower 95% confidence limits of the parameter value</span>
<span class="sd">        determined during curve fitting.</span>
<span class="sd">        Checking the checkbox, fixes the parameter&#39;s value during</span>
<span class="sd">        curve fitting.</span>

<span class="sd">        This trio of widgets follows a set naming convention.</span>
<span class="sd">        spinBoxParameter1, ckbParameter1 and lblParam1 refer</span>
<span class="sd">        to the first parameter; spinBoxParameter2, </span>
<span class="sd">        ckbParameter2 and lblParam2 refer to the second parameter</span>
<span class="sd">        and so on. This set naming convention allows objects </span>
<span class="sd">        corresponding to this trio of widgets for a given parameter</span>
<span class="sd">        to be created using the getattr function. </span>

<span class="sd">        Inputs</span>
<span class="sd">        ------</span>
<span class="sd">        paramNumber - Ordinal number of the parameter, takes values 1-5</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Function FERRET.CurveFitSetConfIntLabel called &#39;</span> <span class="o">+</span>
                   <span class="s1">&#39;with paramNumber=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">objSpinBox</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;spinBoxParameter&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
            <span class="n">objCheckBox</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ckbParameter&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
            <span class="n">objLabel</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;lblParam&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;ConfInt&#39;</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">paramNumber</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">parameterValue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lowerLimit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">upperLimit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">objSpinBox</span><span class="o">.</span><span class="n">suffix</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;%&#39;</span><span class="p">:</span>
                <span class="c1"># Convert decimal fraction to a percentage</span>
                <span class="n">parameterValue</span> <span class="o">=</span> <span class="n">parameterValue</span> <span class="o">*</span> <span class="mf">100.0</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">objCheckBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">lowerLimit</span> <span class="o">=</span> <span class="n">lowerLimit</span> <span class="o">*</span> <span class="mf">100.0</span>
                    <span class="n">upperLimit</span> <span class="o">=</span> <span class="n">upperLimit</span> <span class="o">*</span> <span class="mf">100.0</span>
        
            <span class="n">parameterValue</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">parameterValue</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">objCheckBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">lowerLimit</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">lowerLimit</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">upperLimit</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">upperLimit</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c1"># For display in the PDF report, </span>
            <span class="c1"># overwrite decimal volume fraction values </span>
            <span class="c1"># in  self.optimisedParamaterList with the % equivalent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameterValue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowerLimit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">upperLimit</span>
           
            <span class="k">if</span> <span class="ow">not</span> <span class="n">objCheckBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="c1"># Display 95% confidence limits on the GUI</span>
                <span class="n">confidenceStr</span> <span class="o">=</span> <span class="s1">&#39;[</span><span class="si">{}</span><span class="s1">  </span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lowerLimit</span><span class="p">,</span> <span class="n">upperLimit</span><span class="p">)</span>
                <span class="n">objLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">confidenceStr</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.CurveFitSetConfIntLabel with paramNumber=</span><span class="si">{}</span><span class="s1"> index=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.CurveFitSetConfIntLabel with paramNumber=</span><span class="si">{}</span><span class="s1"> index=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.CurveFitProcessOptimumParameters"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.CurveFitProcessOptimumParameters">[docs]</a>    <span class="k">def</span> <span class="nf">CurveFitProcessOptimumParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays the confidence limits for the optimum </span>
<span class="sd">           parameter values resulting from curve fitting </span>
<span class="sd">           on the right-hand side of the GUI.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Function FERRET.CurveFitProcessOptimumParameters called.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblConfInt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblFix</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblPhysParams</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">modelName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">numParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getNumberOfParameters</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CurveFitSetConfIntLabel</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CurveFitSetConfIntLabel</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CurveFitSetConfIntLabel</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CurveFitSetConfIntLabel</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CurveFitSetConfIntLabel</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.CurveFitProcessOptimumParameters: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.CurveFitProcessOptimumParameters: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.ClearOptimumParamaterConfLimitsOnGUI"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.ClearOptimumParamaterConfLimitsOnGUI">[docs]</a>    <span class="k">def</span> <span class="nf">ClearOptimumParamaterConfLimitsOnGUI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clears the contents of the labels on the left </span>
<span class="sd">        handside of the GUI that display parameter value</span>
<span class="sd">        confidence limits resulting from curve fitting. &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Function FERRET.ClearOptimumParamaterConfLimitsOnGUI called.&#39;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">lblParam1ConfInt</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblParam2ConfInt</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblParam3ConfInt</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblParam4ConfInt</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblParam5ConfInt</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.ClearOptimumParamaterConfLimitsOnGUI: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.ClearOptimumParamaterConfLimitsOnGUI: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>
    

<div class="viewcode-block" id="Ferret.SaveCSVFile"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.SaveCSVFile">[docs]</a>    <span class="k">def</span> <span class="nf">SaveCSVFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Saves in CSV format the data in the plot on the GUI &quot;&quot;&quot;</span> 
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Function FERRET.SaveCSVFile called.&#39;</span><span class="p">)</span>
            <span class="n">modelName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">modelName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">fileName</span><span class="p">:</span>
                <span class="c1"># Ask the user to specify the path &amp; name of the CSV file. The name of the model is suggested as a default file name.</span>
                <span class="n">CSVFileName</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="n">caption</span><span class="o">=</span><span class="s2">&quot;Enter CSV file name&quot;</span><span class="p">,</span> 
                                                 <span class="n">directory</span><span class="o">=</span><span class="n">DEFAULT_PLOT_DATA_FILE_PATH_NAME</span><span class="p">,</span> 
                                                 <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;*.csv&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">CSVFileName</span> <span class="o">=</span> <span class="n">fileName</span>

           <span class="c1"># Check that the user did not press Cancel on the</span>
           <span class="c1"># create file dialog</span>
            <span class="k">if</span> <span class="n">CSVFileName</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Function FERRET.SaveCSVFile - csv file name = &#39;</span> <span class="o">+</span> 
                            <span class="n">CSVFileName</span><span class="p">)</span>
            
                <span class="n">ROI</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
                <span class="n">AIF</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
                    <span class="n">VIF</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
                    <span class="n">mustIncludeVIF</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mustIncludeVIF</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># If CSVFileName already exists, delete it</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">CSVFileName</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">CSVFileName</span><span class="p">)</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">CSVFileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span>  <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
                    <span class="n">writeCSV</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span>  <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">mustIncludeVIF</span><span class="p">:</span>
                        <span class="c1"># write header row</span>
                        <span class="n">writeCSV</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;Time (min)&#39;</span><span class="p">,</span> <span class="n">ROI</span><span class="p">,</span> <span class="n">AIF</span><span class="p">,</span> <span class="n">VIF</span><span class="p">,</span> <span class="n">modelName</span> <span class="o">+</span> <span class="s1">&#39; model&#39;</span><span class="p">])</span>
                        <span class="c1"># Write rows of data</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]):</span>
                            <span class="n">writeCSV</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">ROI</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">AIF</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">VIF</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">listModel</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># write header row</span>
                        <span class="n">writeCSV</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;Time (min)&#39;</span><span class="p">,</span> <span class="n">ROI</span><span class="p">,</span> <span class="n">AIF</span><span class="p">,</span> <span class="n">modelName</span> <span class="o">+</span> <span class="s1">&#39; model&#39;</span><span class="p">])</span>
                        <span class="c1"># Write rows of data</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]):</span>
                            <span class="n">writeCSV</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">ROI</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">AIF</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">listModel</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                    <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">csv</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CSV Writer error in function FERRET.SaveCSVFile: file </span><span class="si">%s</span><span class="s1">, line </span><span class="si">%d</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CSVFileName</span><span class="p">,</span> <span class="n">WriteCSV</span><span class="o">.</span><span class="n">line_num</span><span class="p">,</span> <span class="n">csv</span><span class="o">.</span><span class="n">Error</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;CSV Writer error in function FERRET.SaveCSVFile: file </span><span class="si">%s</span><span class="s1">, line </span><span class="si">%d</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CSVFileName</span><span class="p">,</span> <span class="n">WriteCSV</span><span class="o">.</span><span class="n">line_num</span><span class="p">,</span> <span class="n">csv</span><span class="o">.</span><span class="n">Error</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">IOe</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;IOError in function FERRET.SaveCSVFile: cannot open file &#39;</span> <span class="o">+</span> <span class="n">CSVFileName</span> <span class="o">+</span> <span class="s1">&#39; or read its data: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">IOe</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span> <span class="p">(</span><span class="s1">&#39;IOError in function FERRET.SaveCSVFile: cannot open file &#39;</span> <span class="o">+</span> <span class="n">CSVFileName</span> <span class="o">+</span> <span class="s1">&#39; or read its data; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">IOe</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">re</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Runtime error in function FERRET.SaveCSVFile: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Runtime error in function FERRET.SaveCSVFile: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.SaveCSVFile: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; at line in CSV file &#39;</span><span class="p">,</span> <span class="n">WriteCSV</span><span class="o">.</span><span class="n">line_num</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.SaveCSVFile: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; at line in CSV file &#39;</span><span class="p">,</span> <span class="n">WriteCSV</span><span class="o">.</span><span class="n">line_num</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ferret.clearOptimisedParamaterList"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.clearOptimisedParamaterList">[docs]</a>    <span class="k">def</span> <span class="nf">clearOptimisedParamaterList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callingControl</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clears results of curve fitting from the GUI </span>
<span class="sd">        and from the global list self.optimisedParamaterList &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;FERRET.clearOptimisedParamaterList called from &#39;</span> <span class="o">+</span> <span class="n">callingControl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ClearOptimumParamaterConfLimitsOnGUI</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.clearOptimisedParamaterList: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span> 
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.clearOptimisedParamaterList: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.display_FitModel_SaveCSV_SaveReport_Buttons"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.display_FitModel_SaveCSV_SaveReport_Buttons">[docs]</a>    <span class="k">def</span> <span class="nf">display_FitModel_SaveCSV_SaveReport_Buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays the Fit Model, Save CSV and Save PFD Report</span>
<span class="sd">       buttons if both a ROI &amp; AIF are selected.  </span>
<span class="sd">       Otherwise hides them.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Hide buttons then display them if appropriate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnFitModel</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveCSV</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveReport</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxBatchProcessing</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="n">ROI</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">AIF</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">VIF</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">modelName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">modelInletType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getModelInletType</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Function FERRET.display_FitModel_SaveCSV_SaveReport_Buttons called. Model is &quot;</span> <span class="o">+</span> <span class="n">modelName</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">modelInletType</span> <span class="o">==</span> <span class="s1">&#39;single&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ROI</span> <span class="o">!=</span> <span class="s1">&#39;Please Select&#39;</span> <span class="ow">and</span> <span class="n">AIF</span> <span class="o">!=</span> <span class="s1">&#39;Please Select&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">btnFitModel</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveCSV</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveReport</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxBatchProcessing</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Function FERRET.display_FitModel_SaveCSV_SaveReport_Buttons called when ROI = </span><span class="si">{}</span><span class="s2"> and AIF = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ROI</span><span class="p">,</span> <span class="n">AIF</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">modelInletType</span> <span class="o">==</span> <span class="s1">&#39;dual&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ROI</span> <span class="o">!=</span> <span class="s1">&#39;Please Select&#39;</span> <span class="ow">and</span> <span class="n">AIF</span> <span class="o">!=</span> <span class="s1">&#39;Please Select&#39;</span> <span class="ow">and</span> <span class="n">VIF</span> <span class="o">!=</span> <span class="s1">&#39;Please Select&#39;</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">btnFitModel</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveCSV</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveReport</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxBatchProcessing</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Function FERRET.display_FitModel_SaveCSV_SaveReport_Buttons called when ROI = </span><span class="si">{}</span><span class="s2">, AIF = </span><span class="si">{}</span><span class="s2"> &amp; VIF =</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ROI</span><span class="p">,</span> <span class="n">AIF</span><span class="p">,</span> <span class="n">VIF</span><span class="p">))</span> 
        
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.display_FitModel_SaveCSV_SaveReport_Buttons: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.display_FitModel_SaveCSV_SaveReport_Buttons: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.GetSpinBoxValue"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.GetSpinBoxValue">[docs]</a>    <span class="k">def</span> <span class="nf">GetSpinBoxValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">,</span> <span class="n">initialParametersArray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the value in a parameter spinbox. </span>
<span class="sd">        Converts a % to a decimal fraction if necessary. </span>
<span class="sd">        This value is then appended to the array, initialParametersArray.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Function FERRET.GetSpinBoxValue called when paramNumber=</span><span class="si">{}</span><span class="s1"> and initialParametersArray=</span><span class="si">{}</span><span class="s1">.&#39;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">,</span><span class="n">initialParametersArray</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">objSpinBox</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;spinBoxParameter&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
            <span class="n">parameter</span> <span class="o">=</span> <span class="n">objSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">objSpinBox</span><span class="o">.</span><span class="n">suffix</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;%&#39;</span><span class="p">:</span>
                <span class="c1"># This is a volume fraction so convert % to a decimal fraction</span>
                <span class="n">parameter</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">/</span><span class="mf">100.0</span>
            <span class="n">initialParametersArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.GetSpinBoxValue: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.GetSpinBoxValue: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>
    

<div class="viewcode-block" id="Ferret.BuildParameterArray"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.BuildParameterArray">[docs]</a>    <span class="k">def</span> <span class="nf">BuildParameterArray</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Forms a 1D array of model input parameters</span>
<span class="sd">        for input to the modle function.  </span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">                A list of model input parameter values.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Function FERRET.BuildParameterArray called.&#39;</span><span class="p">)</span>
            <span class="n">initialParametersArray</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">modelName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">numParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getNumberOfParameters</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetSpinBoxValue</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">initialParametersArray</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetSpinBoxValue</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">initialParametersArray</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetSpinBoxValue</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">initialParametersArray</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetSpinBoxValue</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">initialParametersArray</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetSpinBoxValue</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">initialParametersArray</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">initialParametersArray</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.BuildParameterArray &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.BuildParameterArray &#39;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.SetParameterSpinBoxValue"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.SetParameterSpinBoxValue">[docs]</a>    <span class="k">def</span> <span class="nf">SetParameterSpinBoxValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">,</span> <span class="n">parameterList</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the value of an individual parameter spinbox.  If necessary</span>
<span class="sd">        converts a decimal fraction to a %.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Function FERRET.SetParameterSpinBoxValue called.&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">objSpinBox</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;spinBoxParameter&#39;</span> <span class="o">+</span> 
                                 <span class="nb">str</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
            <span class="n">objSpinBox</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">paramNumber</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">objSpinBox</span><span class="o">.</span><span class="n">suffix</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;%&#39;</span><span class="p">:</span>
                <span class="n">objSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">parameterList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">objSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">parameterList</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="n">objSpinBox</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.SetParameterSpinBoxValue &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.SetParameterSpinBoxValue &#39;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.SetParameterSpinBoxValues"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.SetParameterSpinBoxValues">[docs]</a>    <span class="k">def</span> <span class="nf">SetParameterSpinBoxValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameterList</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the value displayed in the model parameter spinboxes </span>
<span class="sd">           to the calculated optimum model parameter values.</span>
<span class="sd">        </span>
<span class="sd">        Input Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">            parameterList - Array of optimum model input parameter values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Function FERRET.SetParameterSpinBoxValues called with parameterList = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parameterList</span><span class="p">))</span>
           
            <span class="n">modelName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">numParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getNumberOfParameters</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SetParameterSpinBoxValue</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">parameterList</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SetParameterSpinBoxValue</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">parameterList</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SetParameterSpinBoxValue</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">parameterList</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SetParameterSpinBoxValue</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">parameterList</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SetParameterSpinBoxValue</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">parameterList</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.SetParameterSpinBoxValues &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.SetParameterSpinBoxValues &#39;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.CurveFitCalculate95ConfidenceLimits"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.CurveFitCalculate95ConfidenceLimits">[docs]</a>    <span class="k">def</span> <span class="nf">CurveFitCalculate95ConfidenceLimits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numDataPoints</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                                            <span class="n">numParams</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                                            <span class="n">optimumParams</span><span class="p">,</span> 
                                            <span class="n">paramCovarianceMatrix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the 95% confidence limits of optimum </span>
<span class="sd">        parameter values resulting from curve fitting. </span>
<span class="sd">        Results are stored in global self.optimisedParamaterList </span>
<span class="sd">        that is used in the creation of the PDF report</span>
<span class="sd">        and to display results on the GUI.</span>
<span class="sd">        </span>
<span class="sd">        Input Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        numDataPoints -  Number of data points to which the model is fitted.</span>
<span class="sd">                Taken as the number of elements in the array of ROI data.</span>
<span class="sd">        numParams - Number of model input parameters.</span>
<span class="sd">        optimumParams - Array of optimum model input parameter values </span>
<span class="sd">                        resulting from curve fitting.</span>
<span class="sd">        paramCovarianceMatrix - The estimated covariance of </span>
<span class="sd">                the values in optimumParams calculated during </span>
<span class="sd">                curve fitting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Function FERRET.CurveFitCalculate95ConfidenceLimits called: numDataPoints =</span><span class="si">{}</span><span class="s1">, numParams=</span><span class="si">{}</span><span class="s1">, optimumParams=</span><span class="si">{}</span><span class="s1">, paramCovarianceMatrix=</span><span class="si">{}</span><span class="s1">&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numDataPoints</span><span class="p">,</span> <span class="n">numParams</span><span class="p">,</span> <span class="n">optimumParams</span><span class="p">,</span> <span class="n">paramCovarianceMatrix</span><span class="p">))</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="c1"># 95% confidence interval = 100*(1-alpha)</span>
            <span class="n">originalOptimumParams</span> <span class="o">=</span> <span class="n">optimumParams</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">originalNumParams</span> <span class="o">=</span> <span class="n">numParams</span>

            <span class="c1"># Check for fixed parameters.</span>
            <span class="c1"># Removed fixed parameters from the optimum parameter list</span>
            <span class="c1"># as they should not be included in the calculation of</span>
            <span class="c1"># confidence limits</span>
            <span class="k">for</span> <span class="n">paramNumber</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">optimumParams</span><span class="p">)</span><span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c1"># Make parameter checkbox</span>
                <span class="n">objCheckBox</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ckbParameter&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">objCheckBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="n">numParams</span> <span class="o">-=</span><span class="mi">1</span>
                    <span class="k">del</span> <span class="n">optimumParams</span><span class="p">[</span><span class="n">paramNumber</span> <span class="o">-</span> <span class="p">(</span><span class="n">originalNumParams</span> <span class="o">-</span> <span class="n">numParams</span><span class="p">)]</span>
                    
            <span class="n">numDegsOfFreedom</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">numDataPoints</span> <span class="o">-</span> <span class="n">numParams</span><span class="p">)</span> 
        
            <span class="c1"># student-t value for the degrees of freedom and the confidence level</span>
            <span class="n">tval</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">alpha</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">numDegsOfFreedom</span><span class="p">)</span>
        
            <span class="c1"># Remove results of previous curve fitting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="c1"># self.optimisedParamaterList is a list of lists. </span>
            <span class="c1"># Add an empty list for each parameter to hold its value </span>
            <span class="c1"># and confidence limits</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numParams</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
           
            <span class="k">for</span> <span class="n">counter</span><span class="p">,</span> <span class="n">numParams</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">numDataPoints</span><span class="p">),</span> <span class="n">optimumParams</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">paramCovarianceMatrix</span><span class="p">)):</span>
                <span class="c1"># Calculate 95% confidence interval for each parameter </span>
                <span class="c1"># allowed to vary and add these to a list</span>
                <span class="n">sigma</span> <span class="o">=</span> <span class="n">var</span><span class="o">**</span><span class="mf">0.5</span>
                <span class="n">lower</span> <span class="o">=</span> <span class="n">numParams</span> <span class="o">-</span> <span class="n">sigma</span><span class="o">*</span><span class="n">tval</span>
                <span class="n">upper</span> <span class="o">=</span> <span class="n">numParams</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">*</span><span class="n">tval</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numParams</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;FERRET Just added value </span><span class="si">{}</span><span class="s1">, lower </span><span class="si">{}</span><span class="s1">, upper </span><span class="si">{}</span><span class="s1"> to self.optimisedParamaterList at position</span><span class="si">{}</span><span class="s1">&#39;</span>
                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numParams</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">counter</span><span class="p">))</span>
            
            <span class="c1"># Now insert fixed parameters into _optimisedParameterList</span>
            <span class="c1"># if there are any.</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">originalNumParams</span><span class="p">):</span>
                <span class="n">objCheckBox</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ckbParameter&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">objCheckBox</span><span class="o">.</span><span class="n">isVisible</span><span class="p">()</span> <span class="ow">and</span> <span class="n">objCheckBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                    <span class="c1"># Add the fixed optimum parameter value to a list</span>
                    <span class="n">fixedParamValue</span> <span class="o">=</span> <span class="n">originalOptimumParams</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">lower</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">upper</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">tempList</span> <span class="o">=</span> <span class="p">[</span><span class="n">fixedParamValue</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">]</span>
                    <span class="c1"># Now add this list to the list of lists </span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">tempList</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;FERRET Just added temp list </span><span class="si">{}</span><span class="s1"> to self.optimisedParamaterList at position</span><span class="si">{}</span><span class="s1">&#39;</span>
                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tempList</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
            
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Leaving FERRET.CurveFitCalculate95ConfidenceLimits, self.optimisedParamaterList = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">rte</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Runtime Error in function FERRET.CurveFitCalculate95ConfidenceLimits &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rte</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Runtime Error in function FERRET.CurveFitCalculate95ConfidenceLimits &#39;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rte</span><span class="p">))</span>  
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.CurveFitCalculate95ConfidenceLimits &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.CurveFitCalculate95ConfidenceLimits &#39;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>  </div>
    

<div class="viewcode-block" id="Ferret.CurveFitGetParameterData"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.CurveFitGetParameterData">[docs]</a>    <span class="k">def</span> <span class="nf">CurveFitGetParameterData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a tuple containing all data associated with a parameter</span>
<span class="sd">        as required by lmfit curve fitting; namely,</span>
<span class="sd">        (parameter name, parameter value, fix parameter value (True/False),</span>
<span class="sd">        minimum value, maximum value, expression, step size)</span>

<span class="sd">        expression &amp; step size are set to None.</span>

<span class="sd">        Input Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        modelName  - Short name of the selected model.</span>
<span class="sd">        paramNumber - Number, 1-5, of the parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Function FERRET.CurveFitGetParameterData called with modelName=</span><span class="si">{}</span><span class="s1"> and paramNumber=</span><span class="si">{}</span><span class="s1">.&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">paramShortName</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getParameterShortName</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">)</span>
            <span class="n">isPercentage</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getParameterLabel</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">)</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getUpperParameterConstraint</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">)</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getLowerParameterConstraint</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">)</span>
            <span class="n">objSpinBox</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;spinBoxParameter&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">objSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">isPercentage</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">/</span><span class="mi">100</span>
            
            <span class="n">vary</span> <span class="o">=</span> <span class="kc">True</span>    
            <span class="n">objCheckBox</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ckbParameter&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">objCheckBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">vary</span> <span class="o">=</span> <span class="kc">False</span>
            
            <span class="n">tempTuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">paramShortName</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">vary</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">tempTuple</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET CurveFitGetParameterData: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET CurveFitGetParameterData: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span></div>


<div class="viewcode-block" id="Ferret.CurveFitCollateParameterData"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.CurveFitCollateParameterData">[docs]</a>    <span class="k">def</span> <span class="nf">CurveFitCollateParameterData</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Forms a 1D array of model input parameters to </span>
<span class="sd">        be used as input to curve fitting.  </span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">                A list of model input parameter values </span>
<span class="sd">                for curve fitting.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET CurveFitCollateParameterData called.&#39;</span><span class="p">)</span>
            <span class="n">parameterDataList</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">modelName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">numParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getNumberOfParameters</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">parameterDataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">CurveFitGetParameterData</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">parameterDataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">CurveFitGetParameterData</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">parameterDataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">CurveFitGetParameterData</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">parameterDataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">CurveFitGetParameterData</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">parameterDataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">CurveFitGetParameterData</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">parameterDataList</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET CurveFitCollateParameterData &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET CurveFitCollateParameterData &#39;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.CurveFit"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.CurveFit">[docs]</a>    <span class="k">def</span> <span class="nf">CurveFit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs curve fitting to fit AIF (and VIF) data </span>
<span class="sd">        to the ROI curve.  Then displays the optimum model </span>
<span class="sd">        input parameters on the GUI and calls </span>
<span class="sd">        the plot function to display the line of best fit </span>
<span class="sd">        on the graph on the GUI</span>
<span class="sd">        when these parameter values are input to the selected model.</span>
<span class="sd">        Also, takes results from curve fitting (optimal parameter values) </span>
<span class="sd">        and determines their 95% confidence limits which are </span>
<span class="sd">        stored in the global list self.optimisedParamaterList.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Form inputs to the curve fitting function</span>
            <span class="n">paramList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CurveFitCollateParameterData</span><span class="p">()</span>
            <span class="n">constantsString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getStringOfConstants</span><span class="p">()</span>
            
            <span class="c1"># Get name of region of interest, arterial and venal input functions</span>
            <span class="n">ROI</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">AIF</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">VIF</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>

            <span class="c1"># Get arrays of data corresponding to the above 3 regions </span>
            <span class="c1"># and the time over which the measurements were made.</span>
            <span class="n">arrayTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                                  <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
            <span class="n">array_ROI_MR_Signals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">ROI</span><span class="p">],</span> 
                                     <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
            <span class="n">array_AIF_MR_Signals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">AIF</span><span class="p">],</span> 
                                     <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">VIF</span> <span class="o">!=</span> <span class="s1">&#39;Please Select&#39;</span><span class="p">:</span>
                <span class="n">array_VIF_MR_Signals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">VIF</span><span class="p">],</span> 
                                         <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Create empty dummy array to act as place holder in  </span>
                <span class="c1"># ModelFunctionsHelper.CurveFit function call </span>
                <span class="n">array_VIF_MR_Signals</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="c1"># Get the name of the model to be fitted to the ROI curve</span>
            <span class="n">modelName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">moduleName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getModuleName</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">moduleName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NoModuleDefined</span>
            <span class="n">functionName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getFunctionName</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">functionName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NoModelFunctionDefined</span>

            <span class="n">inletType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getModelInletType</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">inletType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NoModelInletTypeDefined</span>

            <span class="n">QApplication</span><span class="o">.</span><span class="n">setOverrideCursor</span><span class="p">(</span><span class="n">QCursor</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WaitCursor</span><span class="p">))</span>
            <span class="n">optimumParamsDict</span><span class="p">,</span> <span class="n">paramCovarianceMatrix</span> <span class="o">=</span> \
                <span class="n">ModelFunctionsHelper</span><span class="o">.</span><span class="n">CurveFit</span><span class="p">(</span>
                <span class="n">functionName</span><span class="p">,</span> <span class="n">moduleName</span><span class="p">,</span> <span class="n">paramList</span><span class="p">,</span> <span class="n">arrayTimes</span><span class="p">,</span> 
                <span class="n">array_AIF_MR_Signals</span><span class="p">,</span> <span class="n">array_VIF_MR_Signals</span><span class="p">,</span> <span class="n">array_ROI_MR_Signals</span><span class="p">,</span>
                <span class="n">inletType</span><span class="p">,</span> <span class="n">constantsString</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">isCurveFittingDone</span> <span class="o">=</span> <span class="kc">True</span> 
            <span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;ModelFunctionsHelper.CurveFit returned optimum parameters </span><span class="si">{}</span><span class="s1">&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">optimumParamsDict</span><span class="p">))</span>
            
            <span class="c1"># Display results of curve fitting  </span>
            <span class="c1"># (optimum model parameter values) on GUI.</span>
            <span class="n">optimumParamsList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">optimumParamsDict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ClearOptimumParamaterConfLimitsOnGUI</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetParameterSpinBoxValues</span><span class="p">(</span><span class="n">optimumParamsList</span><span class="p">)</span>

            <span class="c1"># Plot the best curve on the graph</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plotMRSignals</span><span class="p">(</span><span class="s1">&#39;CurveFit&#39;</span><span class="p">)</span>

            <span class="c1"># Determine 95% confidence limits.</span>
            <span class="n">numDataPoints</span> <span class="o">=</span> <span class="n">array_ROI_MR_Signals</span><span class="o">.</span><span class="n">size</span>
            <span class="n">numParams</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">optimumParamsList</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">paramCovarianceMatrix</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CurveFitCalculate95ConfidenceLimits</span><span class="p">(</span><span class="n">numDataPoints</span><span class="p">,</span> <span class="n">numParams</span><span class="p">,</span> 
                                    <span class="n">optimumParamsList</span><span class="p">,</span> <span class="n">paramCovarianceMatrix</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CurveFitProcessOptimumParameters</span><span class="p">()</span>
        
        <span class="k">except</span> <span class="n">NoModelInletTypeDefined</span><span class="p">:</span>
            <span class="n">warningString</span> <span class="o">=</span> <span class="s1">&#39;Cannot procede because no inlet type &#39;</span> <span class="o">+</span> \
                <span class="s1">&#39;is defined for this model in the configuration file.&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">warningString</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;CurveFit - &#39;</span> <span class="o">+</span> <span class="n">warningString</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="p">()</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span>  <span class="s2">&quot;Curve Fitting&quot;</span><span class="p">,</span> <span class="n">warningString</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoModelFunctionDefined</span><span class="p">:</span>
            <span class="n">warningString</span> <span class="o">=</span> <span class="s1">&#39;Cannot procede because no function &#39;</span> <span class="o">+</span> \
                <span class="s1">&#39;is defined for this model in the configuration file.&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">warningString</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;CurveFit - &#39;</span> <span class="o">+</span> <span class="n">warningString</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="p">()</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span>  <span class="s2">&quot;Curve Fitting&quot;</span><span class="p">,</span> <span class="n">warningString</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoModuleDefined</span><span class="p">:</span>
            <span class="n">warningString</span> <span class="o">=</span> <span class="s1">&#39;Cannot procede because no module &#39;</span> <span class="o">+</span> \
                <span class="s1">&#39;is defined for this model function in the configuration file.&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">warningString</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;CurveFit - &#39;</span> <span class="o">+</span> <span class="n">warningString</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="p">()</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span>  <span class="s2">&quot;Curve Fitting&quot;</span><span class="p">,</span> <span class="n">warningString</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Value Error: CurveFit with model &#39;</span> <span class="o">+</span> <span class="n">modelName</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ve</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Value Error: CurveFit with model &#39;</span> <span class="o">+</span> <span class="n">modelName</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ve</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.CurveFit with model &#39;</span> <span class="o">+</span> <span class="n">modelName</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.CurveFit with model &#39;</span> <span class="o">+</span> <span class="n">modelName</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>
    

<div class="viewcode-block" id="Ferret.GetValuesForEachParameter"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.GetValuesForEachParameter">[docs]</a>    <span class="k">def</span> <span class="nf">GetValuesForEachParameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">,</span> 
                    <span class="n">confidenceLimitsArray</span><span class="p">,</span> <span class="n">parameterDictionary</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called by the function, BuildParameterDictionary, for each</span>
<span class="sd">        parameter spinbox, this function builds a list containing the</span>
<span class="sd">        spinbox value and the upper and lower confidence limits (if</span>
<span class="sd">        curve fitting has just been done). This list is then added</span>
<span class="sd">        to the dictionary, parameterDictionary as the value with the</span>
<span class="sd">        full parameter name as the key.  </span>
<span class="sd">        </span>
<span class="sd">         Inputs</span>
<span class="sd">         ------</span>
<span class="sd">         paramNumber - Ordinal number of the parameter on the GUI, which number</span>
<span class="sd">                    from 1 (top) to 5 (bottom).</span>
<span class="sd">         confidenceLimitsArray - An array of upper and lower confidence limits</span>
<span class="sd">                    for the optimum value of each model parameter obtained</span>
<span class="sd">                    after curve fitting.  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET GetValuesForEachParameter called when paramNumber=</span><span class="si">{}</span><span class="s1">.&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
            <span class="n">parameterList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">paramNumber</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">objLabel</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;labelParameter&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
            <span class="n">objSpinBox</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;spinBoxParameter&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">confidenceLimitsArray</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># curve fitting has just been done</span>
                <span class="n">parameterList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">confidenceLimitsArray</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># Parameter Value</span>
                <span class="n">parameterList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">confidenceLimitsArray</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># Lower Limit</span>
                <span class="n">parameterList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">confidenceLimitsArray</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># Upper Limit</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Curve fitting has not just been done</span>
                <span class="n">parameterList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">objSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
                <span class="n">parameterList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
                <span class="n">parameterList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
            
            <span class="n">parameterDictionary</span><span class="p">[</span><span class="n">objLabel</span><span class="o">.</span><span class="n">text</span><span class="p">()]</span> <span class="o">=</span> <span class="n">parameterList</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET GetValuesForEachParameter with model: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET GetValuesForEachParameter with model: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.BuildParameterDictionary"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.BuildParameterDictionary">[docs]</a>    <span class="k">def</span> <span class="nf">BuildParameterDictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confidenceLimitsArray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Builds a dictionary of values and their confidence limits </span>
<span class="sd">        (if curve fitting is performed) for each model input parameter </span>
<span class="sd">        (dictionary key). This dictionary is used to build a </span>
<span class="sd">        parameter values table used to create the PDF report.  </span>
<span class="sd">        It orders the input parameters in the same </span>
<span class="sd">       vertical order as the parameters on the GUI, top to bottom.</span>
<span class="sd">       </span>
<span class="sd">       Inputs</span>
<span class="sd">       ------</span>
<span class="sd">       confidenceLimitsArray - An array of upper and lower confidence limits</span>
<span class="sd">                    for the optimum value of each model parameter obtained</span>
<span class="sd">                    after curve fitting.  If curve fitting has not just</span>
<span class="sd">                    been performed then the default value of None is passed</span>
<span class="sd">                    into this function. </span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;BuildParameterDictionary called with confidence limits array = </span><span class="si">{}</span><span class="s1">&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">confidenceLimitsArray</span><span class="p">))</span>
            <span class="n">parameterDictionary</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">modelName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">numParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getNumberOfParameters</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetValuesForEachParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">confidenceLimitsArray</span><span class="p">,</span> <span class="n">parameterDictionary</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetValuesForEachParameter</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">confidenceLimitsArray</span><span class="p">,</span> <span class="n">parameterDictionary</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetValuesForEachParameter</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span>
                    <span class="n">confidenceLimitsArray</span><span class="p">,</span> <span class="n">parameterDictionary</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetValuesForEachParameter</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span>
                    <span class="n">confidenceLimitsArray</span><span class="p">,</span> <span class="n">parameterDictionary</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetValuesForEachParameter</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span>
                    <span class="n">confidenceLimitsArray</span><span class="p">,</span> <span class="n">parameterDictionary</span><span class="p">)</span>
           
            <span class="k">return</span> <span class="n">parameterDictionary</span>
    
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET BuildParameterDictionary: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET BuildParameterDictionary: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.CreatePDFReport"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.CreatePDFReport">[docs]</a>    <span class="k">def</span> <span class="nf">CreatePDFReport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reportFileName</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates and saves a report of model fitting in PDF format. </span>
<span class="sd">        It includes the name of the model, the current values</span>
<span class="sd">        of its input parameters and a copy of the current plot.</span>
<span class="sd">        </span>
<span class="sd">        Input Parameter:</span>
<span class="sd">        ****************</span>
<span class="sd">            reportFileName - file path and name of the PDF file </span>
<span class="sd">            in which the report will be saved.</span>
<span class="sd">            Used during batch processing.</span>

<span class="sd">        Return:</span>
<span class="sd">        -------</span>
<span class="sd">            parameterDict - A dictionary of parameter short name:value pairs</span>
<span class="sd">                used during batch processing to create the overall results</span>
<span class="sd">                summary, in an Excel spreadsheet, from all the data input files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">PDF</span><span class="p">(</span><span class="n">REPORT_TITLE</span><span class="p">,</span> <span class="n">FERRET_LOGO</span><span class="p">)</span> 
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">reportFileName</span><span class="p">:</span>
                <span class="c1"># Ask the user to specify the path &amp; name of PDF report. </span>
                <span class="c1"># A default report name is suggested, </span>
                <span class="c1"># see the Constant declarations at the top of this file</span>
                <span class="n">reportFileName</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="n">caption</span><span class="o">=</span><span class="s2">&quot;Enter PDF file name&quot;</span><span class="p">,</span> 
                                                                <span class="n">directory</span><span class="o">=</span><span class="n">DEFAULT_REPORT_FILE_PATH_NAME</span><span class="p">,</span> 
                                                                <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;*.pdf&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">reportFileName</span><span class="p">:</span>
                <span class="c1"># If the user has entered the name of a new file, </span>
                <span class="c1"># then we will have to add the .pdf extension</span>
                <span class="c1"># If the user has decided to overwrite an existing file, </span>
                <span class="c1"># then will not have to add the .pdf extension</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">reportFileName</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ext</span> <span class="o">!=</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">:</span>
                    <span class="c1"># Need to add .pdf extension to reportFileName</span>
                    <span class="n">reportFileName</span> <span class="o">=</span> <span class="n">reportFileName</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">reportFileName</span><span class="p">):</span>
                    <span class="c1"># delete existing copy of PDF called reportFileName</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">reportFileName</span><span class="p">)</span> 
                    
                <span class="n">shortModelName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
                <span class="n">longModelName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getLongModelName</span><span class="p">(</span><span class="n">shortModelName</span><span class="p">)</span>

                <span class="c1"># Save a png of the concentration/time plot for display </span>
                <span class="c1"># in the PDF report.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">IMAGE_NAME</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>  <span class="c1"># dpi=150 so as to get a clear image in the PDF report</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCurveFittingDone</span><span class="p">:</span>
                    <span class="n">parameterDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BuildParameterDictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimisedParamaterList</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameterDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BuildParameterDictionary</span><span class="p">()</span>
                             
                <span class="n">QApplication</span><span class="o">.</span><span class="n">setOverrideCursor</span><span class="p">(</span><span class="n">QCursor</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WaitCursor</span><span class="p">))</span>

                <span class="n">pdf</span><span class="o">.</span><span class="n">CreateAndSavePDFReport</span><span class="p">(</span><span class="n">reportFileName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span><span class="p">,</span> 
                       <span class="n">longModelName</span><span class="p">,</span> <span class="n">IMAGE_NAME</span><span class="p">,</span> <span class="n">parameterDict</span><span class="p">)</span>
                
                <span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>

                <span class="c1"># Delete image file</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">IMAGE_NAME</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;PDF Report created called &#39;</span> <span class="o">+</span> <span class="n">reportFileName</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">parameterDict</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET CreatePDFReport: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET CreatePDFReport: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.PopulateModelListCombo"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.PopulateModelListCombo">[docs]</a>    <span class="k">def</span> <span class="nf">PopulateModelListCombo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds a list of model short names from data in the </span>
<span class="sd">        XML configuration file and adds this list to the </span>
<span class="sd">        cmbModels combo box for display on the GUI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET PopulateModelListCombo called.&#39;</span><span class="p">)</span>
            <span class="c1"># Clear the list of models, ready to accept </span>
            <span class="c1"># a new list of models from the XML configuration</span>
            <span class="c1"># file just loaded</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

            <span class="n">tempList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getListModelShortNames</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">tempList</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET PopulateModelListCombo: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET PopulateModelListCombo: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.LoadModelLibrary"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.LoadModelLibrary">[docs]</a>    <span class="k">def</span> <span class="nf">LoadModelLibrary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads the contents of an XML file containing model(s) </span>
<span class="sd">        configuration data.  If the XML file parses successfully,</span>
<span class="sd">        display the &#39;Load Data File&#39; button and build the list </span>
<span class="sd">        of model short names.&quot;&quot;&quot;</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Clear the existing plot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">HideAllControlsOnGUI</span><span class="p">()</span>

            <span class="c1">#  Get the configuration file in XML format.</span>
            <span class="c1"># The filter parameter is set so that the </span>
            <span class="c1"># user can only open an XML file.</span>
            
            <span class="n">fullFilePath</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span> 
                <span class="n">caption</span><span class="o">=</span><span class="s2">&quot;Select model configuration file&quot;</span><span class="p">,</span> 
                <span class="n">directory</span><span class="o">=</span><span class="n">defaultPathModelLibrary</span><span class="p">,</span>
                <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;*.xml&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fullFilePath</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">parseXMLFile</span><span class="p">(</span><span class="n">fullFilePath</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">hasXMLFileParsedOK</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Config file </span><span class="si">{}</span><span class="s1"> loaded&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fullFilePath</span><span class="p">))</span>
                    
                    <span class="n">folderName</span><span class="p">,</span> <span class="n">configFileName</span> <span class="o">=</span> \
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fullFilePath</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s1">&#39;Configuration file &#39;</span> <span class="o">+</span> <span class="n">configFileName</span> <span class="o">+</span> <span class="s1">&#39; loaded&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">btnLoadDataFile</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PopulateModelListCombo</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yAxisLabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getYAxisLabel</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">btnLoadDataFile</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">HideAllControlsOnGUI</span><span class="p">()</span>
                    <span class="n">QMessageBox</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;XML configuration file&quot;</span><span class="p">,</span> <span class="s2">&quot;Error reading XML file &quot;</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;IOError in function FERRET LoadModelLibrary:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ioe</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span> <span class="p">(</span><span class="s1">&#39;IOError in function FERRET LoadModelLibrary: cannot open file&#39;</span> 
                   <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ioe</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">re</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Runtime error in function FERRET LoadModelLibrary: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Runtime error in function FERRET LoadModelLibrary: &#39;</span> 
                         <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET LoadModelLibrary: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET LoadModelLibrary: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>           </div>


<div class="viewcode-block" id="Ferret.LoadDataFile"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.LoadDataFile">[docs]</a>    <span class="k">def</span> <span class="nf">LoadDataFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the contents of a CSV file containing time </span>
<span class="sd">        and MR signal data into a dictionary of lists. </span>
<span class="sd">        The key is the name of the organ or the word &#39;time&#39;  </span>
<span class="sd">        and the corresponding value is a list of MR signals</span>
<span class="sd">        for that organ (or times when the key is &#39;time&#39;).</span>
<span class="sd">        </span>
<span class="sd">        The following validation is applied to the data file:</span>
<span class="sd">            -The CSV file must contain at least 3 columns of data </span>
<span class="sd">                separated by commas.</span>
<span class="sd">            -The first column in the CSV file must contain time data.</span>
<span class="sd">            -The header of the time column must contain the word &#39;time&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># clear the dictionary of previous data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">HideAllControlsOnGUI</span><span class="p">()</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get the data file in csv format.</span>
            <span class="c1"># Filter parameter set so that the user can only</span>
            <span class="c1"># open a csv file.</span>
            <span class="n">dataFileFolder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getDataFileFolder</span><span class="p">()</span>
            <span class="n">fullFilePath</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span> 
                                                     <span class="n">caption</span><span class="o">=</span><span class="s2">&quot;Select csv file&quot;</span><span class="p">,</span> 
                                                     <span class="n">directory</span><span class="o">=</span><span class="n">dataFileFolder</span><span class="p">,</span>
                                                     <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;*.csv&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fullFilePath</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fullFilePath</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">csvfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">MIN_NUM_COLUMNS_CSV_FILE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">QMessageBox</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                          <span class="s2">&quot;CSV data file&quot;</span><span class="p">,</span> 
                          <span class="s2">&quot;The CSV file must contain at least 3 columns of data separated by commas.  The first column must contain time data.&quot;</span><span class="p">,</span> 
                          <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The CSV file must contain at least 3 columns of data separated by commas.&#39;</span><span class="p">)</span>
                    
                    <span class="c1"># Go back to top of the file</span>
                    <span class="n">csvfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">readCSV</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                    <span class="c1"># Get column header labels</span>
                    <span class="c1"># Returns the headers or `None` if the input is empty</span>
                    <span class="n">headers</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">readCSV</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  
                    <span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
                        <span class="n">firstColumnHeader</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">firstColumnHeader</span><span class="p">:</span>
                            <span class="n">QMessageBox</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                               <span class="s2">&quot;CSV data file&quot;</span><span class="p">,</span> 
                               <span class="s2">&quot;The first column must contain time data.&quot;</span><span class="p">,</span> 
                               <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The first column in the CSV file must contain time data.&#39;</span><span class="p">)</span>    

                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;CSV data file </span><span class="si">{}</span><span class="s1"> loaded&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fullFilePath</span><span class="p">))</span>
                    
                    <span class="n">folderName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fullFilePath</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataFileDirectory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fullFilePath</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s1">&#39;File &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span> <span class="o">+</span> <span class="s1">&#39; loaded&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lblBatchProcessing</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Batch process all CSV data files in folder: &quot;</span> <span class="o">+</span> <span class="n">folderName</span><span class="p">)</span>
                    
                    <span class="c1"># Column headers form the keys in the dictionary </span>
                    <span class="c1"># called self.signalData</span>
                    <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">header</span> <span class="o">=</span><span class="s1">&#39;time&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">header</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">=</span><span class="p">[]</span>
                    <span class="c1"># Also add a &#39;model&#39; key to hold a list of concentrations generated by a model</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="c1"># Each key in the dictionary is paired </span>
                    <span class="c1"># with a list of corresponding concentrations </span>
                    <span class="c1"># (except the Time key that is paired </span>
                    <span class="c1"># with a list of times)</span>
                    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">readCSV</span><span class="p">:</span>
                        <span class="n">colNum</span><span class="o">=</span><span class="mi">0</span>
                        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">:</span>
                            <span class="c1"># Iterate over columns in the selected row</span>
                            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">colNum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                                    <span class="c1"># time column</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">colNum</span><span class="p">])</span><span class="o">/</span><span class="mf">60.0</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">colNum</span><span class="p">]))</span>
                                <span class="n">colNum</span><span class="o">+=</span><span class="mi">1</span>           
                <span class="n">csvfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">NormaliseSignalData</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ConfigureGUIAfterLoadingData</span><span class="p">()</span>
                
        <span class="k">except</span> <span class="n">csv</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CSV Reader error in function FERRET LoadDataFile: file </span><span class="si">{}</span><span class="s1">, line </span><span class="si">{}</span><span class="s1">: error=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span><span class="p">,</span> <span class="n">readCSV</span><span class="o">.</span><span class="n">line_num</span><span class="p">,</span> <span class="n">csv</span><span class="o">.</span><span class="n">Error</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;CSV Reader error in function FERRET LoadDataFile: file </span><span class="si">{}</span><span class="s1">, line </span><span class="si">{}</span><span class="s1">: error =</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span><span class="p">,</span> <span class="n">readCSV</span><span class="o">.</span><span class="n">line_num</span><span class="p">,</span> <span class="n">csv</span><span class="o">.</span><span class="n">Error</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;IOError in function FERRET LoadDataFile: cannot open file&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span> <span class="o">+</span> <span class="s1">&#39; or read its data&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span> <span class="p">(</span><span class="s1">&#39;IOError in function FERRET LoadDataFile: cannot open file&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span> <span class="o">+</span> <span class="s1">&#39; or read its data&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">re</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Runtime error in function FERRET LoadDataFile: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Runtime error in function FERRET LoadDataFile: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET LoadDataFile: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; at line </span><span class="si">{}</span><span class="s1"> in the CSV file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">readCSV</span><span class="o">.</span><span class="n">line_num</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET LoadDataFile: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; at line </span><span class="si">{}</span><span class="s1"> in the CSV file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">readCSV</span><span class="o">.</span><span class="n">line_num</span><span class="p">))</span>
            <span class="n">QMessageBox</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;CSV data file&quot;</span><span class="p">,</span> <span class="s2">&quot;Error reading CSV file at line </span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">readCSV</span><span class="o">.</span><span class="n">line_num</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ferret.NormaliseSignalData"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.NormaliseSignalData">[docs]</a>    <span class="k">def</span> <span class="nf">NormaliseSignalData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function FERRET normalises the MR signal data by dividing</span>
<span class="sd">        each data point by the average of the initial baseline</span>
<span class="sd">        scans done before the perfusion agent is added to the </span>
<span class="sd">        bloodstream.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get the number of baseline scans is defined </span>
            <span class="c1"># in the xml configuration file</span>
            <span class="n">numBaseLineScans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getNumBaselineScans</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">signalList</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;model&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
                    <span class="c1"># data from a model is already normalised</span>
                    <span class="k">continue</span>
                
                <span class="c1"># Calculate mean baseline for the current </span>
                <span class="c1"># list of signals</span>
                <span class="n">signalBaseline</span> <span class="o">=</span> \
                    <span class="nb">sum</span><span class="p">(</span><span class="n">signalList</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">numBaseLineScans</span><span class="p">])</span><span class="o">/</span><span class="n">numBaseLineScans</span>

                <span class="c1"># Divide each value in the list by the baseline</span>
                <span class="n">signalList</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">signal</span><span class="o">/</span><span class="n">signalBaseline</span> 
                                 <span class="k">for</span> <span class="n">signal</span> <span class="ow">in</span> <span class="n">signalList</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">signalList</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET NormaliseSignalData: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET NormaliseSignalData: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.HideAllControlsOnGUI"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.HideAllControlsOnGUI">[docs]</a>    <span class="k">def</span> <span class="nf">HideAllControlsOnGUI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hides/clears all the widgets on left-hand side of the application </span>
<span class="sd">        except for the Load &amp; Display Data and Exit buttons.  </span>
<span class="sd">        It is called before a data file is loaded in case the </span>
<span class="sd">        Cancel button on the dialog is clicked.  </span>
<span class="sd">        This prevents the scenario where buttons are displayed </span>
<span class="sd">        but there is no data loaded to process when they are clicked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET HideAllControlsOnGUI called&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">clearMessage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pbar</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lblROI</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxModel</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveReport</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnFitModel</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveCSV</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxBatchProcessing</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span></div>
        

<div class="viewcode-block" id="Ferret.ConfigureGUIAfterLoadingData"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.ConfigureGUIAfterLoadingData">[docs]</a>    <span class="k">def</span> <span class="nf">ConfigureGUIAfterLoadingData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        After successfully loading a datafile, </span>
<span class="sd">        this method loads a list of organs into ROI, </span>
<span class="sd">        AIF &amp; VIF drop-down lists and displays </span>
<span class="sd">        the ROI drop-down list.  </span>
<span class="sd">        It also clears the Matplotlib graph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Reset and show the dropdown list of organs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            
            <span class="c1"># Create a list of organs for which concentrations are</span>
            <span class="c1"># provided in the data input file.  See LoadDataFile method.</span>
            <span class="n">organArray</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">organArray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetListOrgans</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">organArray</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">organArray</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">organArray</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblROI</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="c1"># Clear the existing plot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET ConfigureGUIAfterLoadingData called and the following organ list loaded: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">organArray</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">re</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;runtime error in function FERRET ConfigureGUIAfterLoadingData: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;runtime error in function FERRET ConfigureGUIAfterLoadingData: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET ConfigureGUIAfterLoadingData: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET ConfigureGUIAfterLoadingData: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>
     
            
<div class="viewcode-block" id="Ferret.GetListOrgans"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.GetListOrgans">[docs]</a>    <span class="k">def</span> <span class="nf">GetListOrgans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Builds a list of organs from the headers in the CSV data file. </span>
<span class="sd">        The CSV data file comprises columns of concentration data for a</span>
<span class="sd">        set of organs.  Each column of concentration data is labeled with</span>
<span class="sd">        a header giving the name of organ.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A list of organs for which there is concentration data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET GetListOrgans called&#39;</span><span class="p">)</span>
            <span class="n">organList</span> <span class="o">=</span><span class="p">[]</span>
            <span class="n">organList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Please Select&#39;</span><span class="p">)</span> <span class="c1">#First item at the top of the drop-down list</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;time&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span>  
                    <span class="n">organList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
                    
            <span class="k">return</span> <span class="n">organList</span>

        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">re</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;runtime error in function FERRET GetListOrgans&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;runtime error in function FERRET GetListOrgans&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET GetListOrgans: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET GetListOrgans: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>
    

<div class="viewcode-block" id="Ferret.UncheckFixParameterCheckBoxes"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.UncheckFixParameterCheckBoxes">[docs]</a>    <span class="k">def</span> <span class="nf">UncheckFixParameterCheckBoxes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Uncheckes all the fix parameter checkboxes.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET UncheckFixParameterCheckBoxes called&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter1</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter2</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter2</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter3</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter5</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter1</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter2</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter2</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter3</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter5</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter1</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter2</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter2</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter3</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter5</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ferret.populateParameterLabelAndSpinBox"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.populateParameterLabelAndSpinBox">[docs]</a>    <span class="k">def</span> <span class="nf">populateParameterLabelAndSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When a model is selected, this function is called.  </span>
<span class="sd">        Each model may have upto 5 parameters.  Parameter labels,</span>
<span class="sd">        parameter spinboxes and fix parameter checkboxes already exist</span>
<span class="sd">        on the form but are hidden. The naming convention of these</span>
<span class="sd">        widgets follows a fixed pattern. For the parameter label, this</span>
<span class="sd">        is &#39;labelParameter&#39; followed by a suffix 1, 2, 3, 4 or 5.</span>
<span class="sd">        For the parameter spinbox, this is &#39;spinBoxParameter&#39; </span>
<span class="sd">        followed by a suffix 1, 2, 3, 4 or 5.  For the checkbox</span>
<span class="sd">        that indicates if a parameter should be constrainted during</span>
<span class="sd">        curve fitting this is &#39;ckbParameter&#39; followed by a </span>
<span class="sd">        suffix 1, 2, 3, 4 or 5.</span>

<span class="sd">        This functions creates and configures the parameter label,</span>
<span class="sd">        spinbox and checkbox for a given parameter according to the</span>
<span class="sd">        data in the xml configuration file.</span>

<span class="sd">        Input Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        modelName  - Short name of the selected model.</span>
<span class="sd">        paramNumber - Number, 1-5, of the parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET populateParameterLabelAndSpinBox called with modelName=</span><span class="si">{}</span><span class="s1">, paramNumber=</span><span class="si">{}</span><span class="s1">&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">))</span>
            <span class="n">isPercentage</span><span class="p">,</span> <span class="n">paramName</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getParameterLabel</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">)</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getParameterPrecision</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">)</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getMaxParameterDisplayValue</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">)</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getMinParameterDisplayValue</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">)</span>
            <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getParameterStep</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">)</span>
            <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getParameterDefault</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">)</span>
        
            <span class="n">objLabel</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;labelParameter&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
            <span class="n">objLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">paramName</span><span class="p">)</span>
            <span class="n">objLabel</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            
            <span class="n">objSpinBox</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;spinBoxParameter&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
            <span class="n">objSpinBox</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">objSpinBox</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span>
            <span class="n">objSpinBox</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
            <span class="n">objSpinBox</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="n">objSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">isPercentage</span><span class="p">:</span>
                <span class="n">objSpinBox</span><span class="o">.</span><span class="n">setSuffix</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">objSpinBox</span><span class="o">.</span><span class="n">setSuffix</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">objSpinBox</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">objSpinBox</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="n">objCheckBox</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ckbParameter&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
            <span class="n">objCheckBox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">objCheckBox</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET populateParameterLabelAndSpinBox: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET populateParameterLabelAndSpinBox: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span></div>


<div class="viewcode-block" id="Ferret.SetParameterSpinBoxToDefault"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.SetParameterSpinBoxToDefault">[docs]</a>    <span class="k">def</span> <span class="nf">SetParameterSpinBoxToDefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resets the value of a parameter spinbox to the default</span>
<span class="sd">        stored in the XML configuration file. </span>
<span class="sd">        </span>
<span class="sd">        Input Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        modelName  - Short name of the selected model.</span>
<span class="sd">        paramNumber - Number, 1-5, of the parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;SetParameterSpinBoxToDefault called with paramNumber=&#39;</span> 
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
            <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getParameterDefault</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">paramNumber</span><span class="p">)</span>
        
            <span class="n">objSpinBox</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;spinBoxParameter&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">paramNumber</span><span class="p">))</span>
            <span class="n">objSpinBox</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">objSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
            <span class="n">objSpinBox</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET populateParameterLabelAndSpinBox: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET populateParameterLabelAndSpinBox: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span></div>


<div class="viewcode-block" id="Ferret.InitialiseParameterSpinBoxes"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.InitialiseParameterSpinBoxes">[docs]</a>    <span class="k">def</span> <span class="nf">InitialiseParameterSpinBoxes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialises all the parameter spinbox vales </span>
<span class="sd">        for the selected model by coordinating the </span>
<span class="sd">        calling of the function SetParameterSpinBoxToDefault </span>
<span class="sd">        for each parameter spinbox. &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">modelName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;function FERRET InitialiseParameterSpinBoxes called when model = &#39;</span> 
                <span class="o">+</span> <span class="n">modelName</span><span class="p">)</span>

            <span class="n">numParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getNumberOfParameters</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SetParameterSpinBoxToDefault</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SetParameterSpinBoxToDefault</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SetParameterSpinBoxToDefault</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SetParameterSpinBoxToDefault</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SetParameterSpinBoxToDefault</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET InitialiseParameterSpinBoxes: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET InitialiseParameterSpinBoxes: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span></div>


<div class="viewcode-block" id="Ferret.SetUpParameterLabelsAndSpinBoxes"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.SetUpParameterLabelsAndSpinBoxes">[docs]</a>    <span class="k">def</span> <span class="nf">SetUpParameterLabelsAndSpinBoxes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Coordinates the calling of function</span>
<span class="sd">       populateParameterLabelAndSpinBox to set up and show the </span>
<span class="sd">       parameter spinboxes for each model&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET SetUpParameterLabelsAndSpinBoxes called. &#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">modelName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">numParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getNumberOfParameters</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">populateParameterLabelAndSpinBox</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">populateParameterLabelAndSpinBox</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">populateParameterLabelAndSpinBox</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">populateParameterLabelAndSpinBox</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numParams</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">populateParameterLabelAndSpinBox</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET SetUpParameterLabelsAndSpinBoxes: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET SetUpParameterLabelsAndSpinBoxes: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span></div>


<div class="viewcode-block" id="Ferret.ClearAndHideParameterLabelsSpinBoxesAndCheckBoxes"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.ClearAndHideParameterLabelsSpinBoxesAndCheckBoxes">[docs]</a>    <span class="k">def</span> <span class="nf">ClearAndHideParameterLabelsSpinBoxesAndCheckBoxes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter1</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter2</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter3</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter4</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter5</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter1</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter2</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter3</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter4</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter5</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labelParameter1</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labelParameter2</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labelParameter3</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labelParameter4</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labelParameter5</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter1</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter2</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter3</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter4</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter5</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter1</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter2</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter3</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter4</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter5</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ferret.ConfigureGUIForEachModel"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.ConfigureGUIForEachModel">[docs]</a>    <span class="k">def</span> <span class="nf">ConfigureGUIForEachModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;When a model is selected, this method configures </span>
<span class="sd">        the appearance of the GUI accordingly.  </span>
<span class="sd">        For example, spinboxes for the input of model parameter </span>
<span class="sd">        values are given an appropriate label.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">modelName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET ConfigureGUIForEachModel called when model = &#39;</span> <span class="o">+</span> <span class="n">modelName</span><span class="p">)</span>   
            <span class="c1">#self.cboxDelay.show()</span>
            <span class="c1">#self.cboxConstaint.show()</span>
            <span class="c1">#self.cboxConstaint.setChecked(False)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnReset</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveReport</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pbar</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ClearAndHideParameterLabelsSpinBoxesAndCheckBoxes</span><span class="p">()</span>
            
            <span class="c1">##Configure parameter spinboxes and their labels for each model</span>
            <span class="k">if</span> <span class="n">modelName</span> <span class="o">==</span> <span class="s1">&#39;Select a model&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lblAIF</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lblVIF</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cboxDelay</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cboxConstaint</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">btnReset</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">btnFitModel</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveReport</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveCSV</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">groupBoxBatchProcessing</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lblConfInt</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lblFix</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lblPhysParams</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SetUpParameterLabelsAndSpinBoxes</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lblConfInt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lblFix</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lblPhysParams</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lblAIF</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> <span class="c1">#Common to all models</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> <span class="c1">#Common to all models</span>
                <span class="n">inletType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getModelInletType</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inletType</span> <span class="o">==</span> <span class="s1">&#39;single&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lblVIF</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">inletType</span> <span class="o">==</span> <span class="s1">&#39;dual&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lblVIF</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET ConfigureGUIForEachModel: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET ConfigureGUIForEachModel: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span></div>
           
            
    <span class="c1">#def GetScreenResolution(self):</span>
    <span class="c1">#    &quot;&quot;&quot;Determines the screen resolution of the device </span>
    <span class="c1">#    running this software.</span>
        
    <span class="c1">#    Returns</span>
    <span class="c1">#    -------</span>
    <span class="c1">#        Returns the width &amp; height of the device screen in pixels.</span>
    <span class="c1">#    &quot;&quot;&quot;</span>
    <span class="c1">#    try:</span>
    <span class="c1">#        width, height = pyautogui.size()</span>
    <span class="c1">#        logger.info(&#39;function FERRET GetScreenResolution called. Screen width = {}, height = {}.&#39;.format(width, height))</span>
    <span class="c1">#        return width, height</span>
    <span class="c1">#    except Exception as e:</span>
    <span class="c1">#        print(&#39;Error in function FERRET GetScreenResolution: &#39; + str(e) )</span>
    <span class="c1">#        logger.error(&#39;Error in function FERRET GetScreenResolution: &#39; + str(e) )</span>
        

<div class="viewcode-block" id="Ferret.DetermineTextSize"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.DetermineTextSize">[docs]</a>    <span class="k">def</span> <span class="nf">DetermineTextSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determines the optimum size for the title &amp; labels on the </span>
<span class="sd">           matplotlib graph from the screen resolution.</span>
<span class="sd">           </span>
<span class="sd">           Returns</span>
<span class="sd">           -------</span>
<span class="sd">              tick label size, xy axis label size &amp; title size</span>
<span class="sd">           &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET DetermineTextSize called.&#39;</span><span class="p">)</span>
           <span class="c1">#width, _ = self.GetScreenResolution()</span>
            
            <span class="c1">#if width == 1920: #Desktop</span>
            <span class="c1">#    tickLabelSize = 12</span>
            <span class="c1">#    xyAxisLabelSize = 14</span>
            <span class="c1">#    titleSize = 20</span>
            <span class="c1">#elif width == 2560: #Laptop</span>
            <span class="n">tickLabelSize</span> <span class="o">=</span> <span class="mi">16</span>
            <span class="n">xyAxisLabelSize</span> <span class="o">=</span> <span class="mi">18</span>
            <span class="n">titleSize</span> <span class="o">=</span> <span class="mi">24</span>
            <span class="c1">#else:</span>
            <span class="c1">#    tickLabelSize = 12</span>
            <span class="c1">#    xyAxisLabelSize = 14</span>
            <span class="c1">#    titleSize = 20</span>

            <span class="k">return</span> <span class="n">tickLabelSize</span><span class="p">,</span> <span class="n">xyAxisLabelSize</span><span class="p">,</span> <span class="n">titleSize</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET DetermineTextSize: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET DetermineTextSize: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span></div>
    

<div class="viewcode-block" id="Ferret.plotModelCurve"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.plotModelCurve">[docs]</a>    <span class="k">def</span> <span class="nf">plotModelCurve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelName</span><span class="p">,</span> 
                       <span class="n">inletType</span><span class="p">,</span>
                       <span class="n">arrayTimes</span><span class="p">,</span> 
                       <span class="n">array_AIF_MR_Signals</span><span class="p">,</span> 
                       <span class="n">array_VIF_MR_Signals</span><span class="p">,</span> <span class="n">objSubPlot</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calls the function that calculates the </span>
<span class="sd">        MR signal/time curve using the selected model and then</span>
<span class="sd">        plots this curve on the matplotlib plot.</span>

<span class="sd">        Inputs</span>
<span class="sd">        ------</span>
<span class="sd">        modelName - short name of the select model</span>
<span class="sd">        inletType - inlet type of the model, single or dual</span>
<span class="sd">        arrayTimes - array of time points over which the</span>
<span class="sd">                MR signal data is recorded.</span>
<span class="sd">        array_AIF_MR_Signals - array of AIF MR signal data over</span>
<span class="sd">                the time period stored in arrayTimes.</span>
<span class="sd">        array_VIF_MR_Signals - array of VIF MR signal data over</span>
<span class="sd">                the time period stored in arrayTimes.</span>
<span class="sd">        objSubPlot - object pointing to the matplotlib plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parameterArray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BuildParameterArray</span><span class="p">()</span>
            <span class="n">constantsString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getStringOfConstants</span><span class="p">()</span>
            <span class="n">modelFunctionName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getFunctionName</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>
            <span class="n">moduleName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getModuleName</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;ModelFunctionsHelper.ModelSelector called when model=</span><span class="si">{}</span><span class="s1">, function =</span><span class="si">{}</span><span class="s1"> &amp; parameter array = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span> <span class="nb">format</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">modelFunctionName</span><span class="p">,</span> <span class="n">parameterArray</span><span class="p">))</span>        
            
            <span class="bp">self</span><span class="o">.</span><span class="n">listModel</span> <span class="o">=</span> <span class="n">ModelFunctionsHelper</span><span class="o">.</span><span class="n">ModelSelector</span><span class="p">(</span>
                        <span class="n">modelFunctionName</span><span class="p">,</span> <span class="n">moduleName</span><span class="p">,</span>
                        <span class="n">inletType</span><span class="p">,</span> <span class="n">arrayTimes</span><span class="p">,</span> <span class="n">array_AIF_MR_Signals</span><span class="p">,</span> 
                        <span class="n">parameterArray</span><span class="p">,</span> <span class="n">constantsString</span><span class="p">,</span>
                        <span class="n">array_VIF_MR_Signals</span><span class="p">)</span>
            
            <span class="n">arrayModel</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listModel</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
            <span class="n">objSubPlot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">arrayTimes</span><span class="p">,</span> <span class="n">arrayModel</span><span class="p">,</span> <span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="n">modelName</span> <span class="o">+</span> <span class="s1">&#39; model&#39;</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET.plotModelCurve &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET plotModelCurve &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span></div>
    

<div class="viewcode-block" id="Ferret.setUpPlot"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.setUpPlot">[docs]</a>    <span class="k">def</span> <span class="nf">setUpPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function draws the matplotlib plot on the GUI</span>
<span class="sd">        for the display of the MR signal/time curves.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET setUpPlot called.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        
            <span class="n">objSubPlot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            
            <span class="c1"># Get the optimum label size for the screen resolution.</span>
            <span class="n">tickLabelSize</span><span class="p">,</span> <span class="n">xyAxisLabelSize</span><span class="p">,</span> <span class="n">titleSize</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">DetermineTextSize</span><span class="p">()</span>

            <span class="c1"># Set size of the x,y axis tick labels</span>
            <span class="n">objSubPlot</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> 
                                   <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> 
                                   <span class="n">labelsize</span><span class="o">=</span><span class="n">tickLabelSize</span><span class="p">)</span>

            <span class="n">objSubPlot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (mins)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">xyAxisLabelSize</span><span class="p">)</span>
            <span class="n">objSubPlot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yAxisLabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">xyAxisLabelSize</span><span class="p">)</span>
            <span class="n">objSubPlot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Time Curves&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">titleSize</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
            <span class="n">objSubPlot</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">objSubPlot</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET setUpPlot: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET setUpPlot: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="Ferret.setUpLegendBox"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.setUpLegendBox">[docs]</a>    <span class="k">def</span> <span class="nf">setUpLegendBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objPlot</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function draws the legend box holding the key</span>
<span class="sd">        to the MR signal/time curves on the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET setUpLegendBox called.&#39;</span><span class="p">)</span>
        <span class="n">chartBox</span> <span class="o">=</span> <span class="n">objPlot</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="n">objPlot</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">chartBox</span><span class="o">.</span><span class="n">x0</span><span class="o">*</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">chartBox</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> 
                              <span class="n">chartBox</span><span class="o">.</span><span class="n">width</span><span class="o">*</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">chartBox</span><span class="o">.</span><span class="n">height</span><span class="p">])</span>
        <span class="n">objPlot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> 
                       <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> 
                       <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ferret.plotMRSignals"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.plotMRSignals">[docs]</a>    <span class="k">def</span> <span class="nf">plotMRSignals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameCallingFunction</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If a Region of Interest has been selected, </span>
<span class="sd">        this function plots the normalised signal against time curves </span>
<span class="sd">        for the ROI, AIF, VIF.  </span>
<span class="sd">        Also, plots the normalised signal/time curve predicted by the </span>
<span class="sd">        selected model.</span>
<span class="sd">        </span>
<span class="sd">        Input Parameter</span>
<span class="sd">        ----------------</span>
<span class="sd">        nameCallingFunction - Name of the function or widget from whose event </span>
<span class="sd">        this function is called. This information is used in logging and error</span>
<span class="sd">        handling.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">boolAIFSelected</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">boolVIFSelected</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">objPlot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setUpPlot</span><span class="p">()</span>

            <span class="c1"># Get the names of the regions </span>
            <span class="c1"># selected from the drop down lists.</span>
            <span class="n">ROI</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">AIF</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">VIF</span> <span class="o">=</span> <span class="s1">&#39;Not Selected&#39;</span>
            <span class="n">VIF</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET plot called from &#39;</span> <span class="o">+</span>
                        <span class="n">nameCallingFunction</span> <span class="o">+</span> 
                        <span class="s1">&#39; when ROI=</span><span class="si">{}</span><span class="s1">, AIF=</span><span class="si">{}</span><span class="s1"> and VIF=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ROI</span><span class="p">,</span> <span class="n">AIF</span><span class="p">,</span> <span class="n">VIF</span><span class="p">))</span>

            <span class="n">arrayTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">AIF</span> <span class="o">!=</span> <span class="s1">&#39;Please Select&#39;</span><span class="p">:</span>
                <span class="n">array_AIF_MR_Signals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">AIF</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
                <span class="n">objPlot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">arrayTimes</span><span class="p">,</span> <span class="n">array_AIF_MR_Signals</span><span class="p">,</span> <span class="s1">&#39;r.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="n">AIF</span><span class="p">)</span>
                <span class="n">boolAIFSelected</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">array_VIF_MR_Signals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">VIF</span> <span class="o">!=</span> <span class="s1">&#39;Please Select&#39;</span><span class="p">:</span>
                <span class="n">array_VIF_MR_Signals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">VIF</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
                <span class="n">objPlot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">arrayTimes</span><span class="p">,</span> <span class="n">array_VIF_MR_Signals</span><span class="p">,</span> <span class="s1">&#39;k.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="n">VIF</span><span class="p">)</span>
                <span class="n">boolVIFSelected</span> <span class="o">=</span> <span class="kc">True</span>
                    
            <span class="c1"># Plot concentration curve from the model</span>
            <span class="n">modelName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">modelName</span> <span class="o">!=</span> <span class="s1">&#39;Select a model&#39;</span><span class="p">:</span>
                <span class="n">inletType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getModelInletType</span><span class="p">(</span><span class="n">modelName</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">inletType</span> <span class="o">==</span> <span class="s1">&#39;dual&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="n">boolAIFSelected</span> <span class="ow">and</span> <span class="n">boolVIFSelected</span><span class="p">)</span> \
                    <span class="ow">or</span> \
                    <span class="p">(</span><span class="n">inletType</span> <span class="o">==</span> <span class="s1">&#39;single&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">boolAIFSelected</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotModelCurve</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="n">inletType</span><span class="p">,</span>
                                        <span class="n">arrayTimes</span><span class="p">,</span> 
                                        <span class="n">array_AIF_MR_Signals</span><span class="p">,</span> 
                                       <span class="n">array_VIF_MR_Signals</span><span class="p">,</span> <span class="n">objPlot</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ROI</span> <span class="o">!=</span> <span class="s1">&#39;Please Select&#39;</span><span class="p">:</span>
                <span class="n">array_ROI_MR_Signals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">ROI</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
                <span class="n">objPlot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">arrayTimes</span><span class="p">,</span> <span class="n">array_ROI_MR_Signals</span><span class="p">,</span> <span class="s1">&#39;b.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="n">ROI</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">setUpLegendBox</span><span class="p">(</span><span class="n">objPlot</span><span class="p">)</span>
                
                <span class="c1"># Refresh canvas</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Draw a blank graph on the canvas</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET plotMRSignals when an event associated with &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nameCallingFunction</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; is fired : ROI=&#39;</span> <span class="o">+</span> <span class="n">ROI</span> <span class="o">+</span> <span class="s1">&#39; AIF = &#39;</span> <span class="o">+</span> <span class="n">AIF</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET plotMRSignals when an event associated with &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nameCallingFunction</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; is fired : ROI=&#39;</span> <span class="o">+</span> <span class="n">ROI</span> <span class="o">+</span> <span class="s1">&#39; AIF = &#39;</span> <span class="o">+</span> <span class="n">AIF</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span></div>
    

<div class="viewcode-block" id="Ferret.closeWindow"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.closeWindow">[docs]</a>    <span class="k">def</span> <span class="nf">closeWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Closes the Model Fitting application.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;FERRET closed using the Exit button.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">clearMessage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thisWindow</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> </div>


<div class="viewcode-block" id="Ferret.toggleEnabled"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.toggleEnabled">[docs]</a>    <span class="k">def</span> <span class="nf">toggleEnabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boolEnabled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Used to disable all the controls on the form </span>
<span class="sd">        during batch processing and to enable them again </span>
<span class="sd">        when batch processing is complete.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnClose</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnLoadDataFile</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveReport</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnClose</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnReset</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnFitModel</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnSaveCSV</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter1</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter2</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter3</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter4</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter5</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnBatchProc</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter1</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter2</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter2</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter3</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckbParameter5</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">boolEnabled</span><span class="p">)</span></div>
        

<div class="viewcode-block" id="Ferret.BatchProcessAllCSVDataFiles"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.BatchProcessAllCSVDataFiles">[docs]</a>    <span class="k">def</span> <span class="nf">BatchProcessAllCSVDataFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       When a CSV data file is selected, the path to its folder is saved.</span>
<span class="sd">       This function processes all the CSV data files in that folder by </span>
<span class="sd">       performing curve fitting using the selected model. </span>
<span class="sd">       </span>
<span class="sd">       The results for each data file are written to an Excel spreadsheet.  </span>
<span class="sd">       If a CSV file cannot be read then its name is also recorded in the </span>
<span class="sd">       Excel spreadsheet together with the reason why it could not be read.</span>
<span class="sd">       </span>
<span class="sd">       As each data file is processed, a PDF report with a plot of the </span>
<span class="sd">       time/concentration curves is generated and stored in a sub-folder </span>
<span class="sd">       in the folder where the data files are held.  Likewise, a CSV file</span>
<span class="sd">       holding the time and concentration data (including the model curve)</span>
<span class="sd">       in the is created in another sub-folder in the folder where the </span>
<span class="sd">       data files are held.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET BatchProcessAllCSVDataFiles called.&#39;</span><span class="p">)</span>
            
            <span class="c1"># Create a list of csv files in the selected directory</span>
            <span class="n">csvDataFiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> 
                            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFileDirectory</span><span class="p">)</span> 
                            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">)]</span>

            <span class="n">numCSVFiles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">csvDataFiles</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lblBatchProcessing</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lblBatchProcessing</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1"> csv files.&#39;</span>
                                       <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFileDirectory</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">numCSVFiles</span><span class="p">)))</span>

            <span class="c1"># Make nested folders to hold CSV files </span>
            <span class="c1"># of plot data and PDF reports</span>
            <span class="n">csvPlotDataFolder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFileDirectory</span> <span class="o">+</span> <span class="s1">&#39;/CSVPlotDataFiles&#39;</span>
            <span class="n">pdfReportFolder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFileDirectory</span> <span class="o">+</span> <span class="s1">&#39;/PDFReports&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">csvPlotDataFolder</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">csvPlotDataFolder</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;BatchProcessAllCSVDataFiles: </span><span class="si">{}</span><span class="s1"> created.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">csvPlotDataFolder</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pdfReportFolder</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">pdfReportFolder</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;BatchProcessAllCSVDataFiles: </span><span class="si">{}</span><span class="s1"> created.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pdfReportFolder</span><span class="p">))</span>
            
            <span class="c1"># Set up progress bar</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pbar</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pbar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="n">numCSVFiles</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pbar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
            <span class="n">boolUseParameterDefaultValues</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># If the user has changed one or more parameter values</span>
            <span class="c1"># ask if they still wish to use the parameter default valuesSet</span>
            <span class="c1"># or the values they have selected.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">BatchProcessingHaveParamsChanged</span><span class="p">():</span>
                <span class="n">buttonReply</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisWindow</span><span class="p">,</span> 
                       <span class="s1">&#39;Parameter values changed.&#39;</span><span class="p">,</span> 
                       <span class="s2">&quot;As initial values, do you wish to use to use the new parameter values (Yes) or the default values (No)?&quot;</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">,</span> 
                       <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">buttonReply</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;BatchProcessAllCSVDataFiles: Using new parameter values&#39;</span><span class="p">)</span>
                    <span class="n">boolUseParameterDefaultValues</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="c1">#Store new parameter values</span>
                    <span class="n">initialParameterArray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BuildParameterArray</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;BatchProcessAllCSVDataFiles: Using default parameter values&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">toggleEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            <span class="c1"># Counter to show progress of batch processing in </span>
            <span class="c1"># progress bar.</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>  

            <span class="n">modelName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>

            <span class="c1"># Create the Excel spreadsheet to record the results</span>
            <span class="n">objSpreadSheet</span><span class="p">,</span> <span class="n">boolExcelFileCreatedOK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BatchProcessingCreateBatchSummaryExcelSpreadSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFileDirectory</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">boolExcelFileCreatedOK</span><span class="p">:</span>
                <span class="n">QApplication</span><span class="o">.</span><span class="n">setOverrideCursor</span><span class="p">(</span><span class="n">QCursor</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WaitCursor</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">csvDataFiles</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">boolUseParameterDefaultValues</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">InitialiseParameterSpinBoxes</span><span class="p">()</span> <span class="c1">#Reset default values</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Reset parameters to values selected by the user before</span>
                        <span class="c1"># the start of batch processing</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">SetParameterSpinBoxValues</span><span class="p">(</span><span class="n">initialParameterArray</span><span class="p">)</span>

                    <span class="c1"># Set class instance property dataFileName </span>
                    <span class="c1"># to name of file in current iteration </span>
                    <span class="c1">#  this variable used to write datafile </span>
                    <span class="c1">#  in the PDF report</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s1">&#39;File &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span> <span class="o">+</span> <span class="s1">&#39; loaded.&#39;</span><span class="p">)</span>
                    <span class="n">count</span> <span class="o">+=</span><span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lblBatchProcessing</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Processing </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span><span class="p">))</span>
                    <span class="c1"># Load current file</span>
                    <span class="n">fileLoadedOK</span><span class="p">,</span> <span class="n">failureReason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BatchProcessingLoadDataFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFileDirectory</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">fileLoadedOK</span><span class="p">:</span>
                        <span class="n">objSpreadSheet</span><span class="o">.</span><span class="n">recordSkippedFiles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span><span class="p">,</span> <span class="n">failureReason</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pbar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                        <span class="k">continue</span>  <span class="c1"># Skip this iteration if problems loading file</span>
                
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotMRSignals</span><span class="p">(</span><span class="s1">&#39;BatchProcessAllCSVDataFiles&#39;</span><span class="p">)</span> <span class="c1">#Plot data                </span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">CurveFit</span><span class="p">()</span> <span class="c1"># Fit curve to model </span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">SaveCSVFile</span><span class="p">(</span><span class="n">csvPlotDataFolder</span> <span class="o">+</span> <span class="s1">&#39;/plot&#39;</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span> <span class="c1">#Save plot data to CSV file               </span>
                    <span class="n">parameterDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CreatePDFReport</span><span class="p">(</span><span class="n">pdfReportFolder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#Save PDF Report                </span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">BatchProcessWriteOptimumParamsToSummary</span><span class="p">(</span><span class="n">objSpreadSheet</span><span class="p">,</span> 
                               <span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span><span class="p">,</span>  <span class="n">modelName</span><span class="p">,</span> <span class="n">parameterDict</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pbar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                    <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lblBatchProcessing</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Batch processing complete.&quot;</span><span class="p">)</span>
                <span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">toggleEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">objSpreadSheet</span><span class="o">.</span><span class="n">saveSpreadSheet</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET BatchProcessAllCSVDataFiles: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET BatchProcessAllCSVDataFiles: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggleEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>     </div>


<div class="viewcode-block" id="Ferret.BatchProcessingCreateBatchSummaryExcelSpreadSheet"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.BatchProcessingCreateBatchSummaryExcelSpreadSheet">[docs]</a>    <span class="k">def</span> <span class="nf">BatchProcessingCreateBatchSummaryExcelSpreadSheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                                                <span class="n">pathToFolder</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates an Excel spreadsheet to hold a summary of model </span>
<span class="sd">        fitting a batch of data files</span>
<span class="sd">        </span>
<span class="sd">        Input</span>
<span class="sd">        -----</span>
<span class="sd">           pathToFolder - location of the folder holding the </span>
<span class="sd">                MR signal data</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="k">try</span><span class="p">:</span>
            <span class="n">boolExcelFileCreatedOK</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET BatchProcessingCreateBatchSummaryExcelSpreadSheet called.&#39;</span><span class="p">)</span>

            <span class="c1">#Ask the user to specify the path &amp; name of the Excel spreadsheet file. </span>
            <span class="n">ExcelFileName</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span>
                           <span class="n">caption</span><span class="o">=</span><span class="s2">&quot;Batch Summary Excel file name&quot;</span><span class="p">,</span> 
                           <span class="n">directory</span><span class="o">=</span><span class="n">pathToFolder</span> <span class="o">+</span> <span class="s2">&quot;//BatchSummary&quot;</span><span class="p">,</span> 
                           <span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;*.xlsx&quot;</span><span class="p">)</span>

           <span class="c1">#Check that the user did not press Cancel on the create file dialog</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ExcelFileName</span><span class="p">:</span>
                <span class="n">ExcelFileName</span> <span class="o">=</span> <span class="n">pathToFolder</span> <span class="o">+</span> <span class="s2">&quot;//BatchSummary.xlsx&quot;</span>
           
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET BatchProcessingCreateBatchSummaryExcelSpreadSheet - Excel file name = &#39;</span> <span class="o">+</span> <span class="n">ExcelFileName</span><span class="p">)</span>

            <span class="c1">#If ExcelFileName already exists, delete it</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ExcelFileName</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ExcelFileName</span><span class="p">)</span>
            
            <span class="c1">#Create spreadsheet object</span>
            <span class="n">spreadSheet</span> <span class="o">=</span> <span class="n">ExcelWriter</span><span class="p">(</span><span class="n">ExcelFileName</span><span class="p">,</span> <span class="n">FERRET_LOGO</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">spreadSheet</span><span class="p">,</span> <span class="n">boolExcelFileCreatedOK</span>

        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">ose</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span> <span class="p">(</span><span class="n">ExcelFileName</span> <span class="o">+</span> <span class="s1">&#39;is open. It must be closed. Error =&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ose</span><span class="p">))</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Spreadsheet open in Excel&#39;</span><span class="p">,</span> 
                       <span class="s2">&quot;Close the batch summary spreadsheet and try again&quot;</span><span class="p">,</span> 
                       <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">,</span> 
                       <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggleEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">boolExcelFileCreatedOK</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">boolExcelFileCreatedOK</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">re</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Runtime error in function FERRET BatchProcessingCreateBatchSummaryExcelSpreadSheet: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Runtime error in function FERRET BatchProcessingCreateBatchSummaryExcelSpreadSheet: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggleEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">boolExcelFileCreatedOK</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">boolExcelFileCreatedOK</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET BatchProcessingCreateBatchSummaryExcelSpreadSheet: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET BatchProcessingCreateBatchSummaryExcelSpreadSheet: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">toggleEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">boolExcelFileCreatedOK</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">boolExcelFileCreatedOK</span></div>


<div class="viewcode-block" id="Ferret.BatchProcessWriteOptimumParamsToSummary"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.BatchProcessWriteOptimumParamsToSummary">[docs]</a>    <span class="k">def</span> <span class="nf">BatchProcessWriteOptimumParamsToSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                                                <span class="n">objExcelFile</span><span class="p">,</span> 
                                                <span class="n">fileName</span><span class="p">,</span> 
                                                <span class="n">modelName</span><span class="p">,</span> 
                                                <span class="n">paramDict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;During batch processing of data files, writes </span>
<span class="sd">        the optimum parameter values resulting from  </span>
<span class="sd">       curve fitting to Excel spreadsheet.</span>
<span class="sd">       </span>
<span class="sd">       Inputs</span>
<span class="sd">       -----</span>
<span class="sd">       objExcelFile - object instanciated from the ExcellWriter class</span>
<span class="sd">       fileName - Name of the MR Signal data file currently being</span>
<span class="sd">            batch processed.</span>
<span class="sd">       modelName - Name of the model being used for curve fitting.</span>
<span class="sd">       paramDict - Dictionary of optimum parameter values determined</span>
<span class="sd">            by the curve fitting process</span>
<span class="sd">       &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">paramName</span><span class="p">,</span> <span class="n">paramList</span> <span class="ow">in</span> <span class="n">paramDict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
                <span class="n">paramName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">paramName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">paramName</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">paramName</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">paramList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
                <span class="n">lower</span> <span class="o">=</span> <span class="n">paramList</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">upper</span> <span class="o">=</span> <span class="n">paramList</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">objExcelFile</span><span class="o">.</span><span class="n">recordParameterValues</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">modelName</span><span class="p">,</span> <span class="n">paramName</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
                
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET BatchProcessWriteOptimumParamsToSummary: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET BatchProcessWriteOptimumParamsToSummary: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggleEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>      </div>


<div class="viewcode-block" id="Ferret.BatchProcessingLoadDataFile"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.BatchProcessingLoadDataFile">[docs]</a>    <span class="k">def</span> <span class="nf">BatchProcessingLoadDataFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullFilePath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Loads the contents of a CSV file containing time and concentration data</span>
<span class="sd">        into a dictionary of lists. The key is the name of the organ or &#39;time&#39; and </span>
<span class="sd">        the corresponding value is a list of concentrations </span>
<span class="sd">        (or times when the key is &#39;time&#39;)</span>
<span class="sd">        </span>
<span class="sd">        The following validation is applied to the data file:</span>
<span class="sd">            -The CSV file must contain at least 3 columns of data separated by commas.</span>
<span class="sd">            -The first column in the CSV file must contain time data.</span>
<span class="sd">            -The header of the time column must contain the word &#39;time&#39;.</span>
<span class="sd">       </span>
<span class="sd">        Input Parameters:</span>
<span class="sd">        ******************</span>
<span class="sd">            fullFilePath - Full file path to a CSV file containing </span>
<span class="sd">                            time/concentration data    </span>
<span class="sd">        &quot;&quot;&quot;</span>
      
        <span class="c1"># clear the dictionary of previous data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="n">boolFileFormatOK</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">boolDataOK</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">failureReason</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fullFilePath</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fullFilePath</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">csvfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">MIN_NUM_COLUMNS_CSV_FILE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">boolFileFormatOK</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">failureReason</span> <span class="o">=</span> <span class="s2">&quot;At least 3 columns of data are expected&quot;</span>
                        <span class="n">errorStr</span> <span class="o">=</span> <span class="s1">&#39;Batch Processing: CSV file </span><span class="si">{}</span><span class="s1"> must acontain at least 3 columns of data separated by commas.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fullFilePath</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">errorStr</span><span class="p">)</span>
                        
                    <span class="c1"># Go back to top of the file</span>
                    <span class="n">csvfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">readCSV</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                    <span class="c1"># Get column header labels</span>
                    <span class="n">headers</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">readCSV</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># returns the headers or `None` if the input is empty</span>
                    <span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
                        <span class="n">join</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">firstColumnHeader</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">firstColumnHeader</span><span class="p">:</span>
                            <span class="n">boolFileFormatOK</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failureReason</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">join</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span>
                            <span class="n">failureReason</span> <span class="o">=</span> <span class="n">failureReason</span> <span class="o">+</span> <span class="n">join</span> <span class="o">+</span> \
                           <span class="s2">&quot;First column must contain time data, with the word &#39;time&#39; as a header&quot;</span>
                            <span class="n">errorStr</span> <span class="o">=</span> <span class="s1">&#39;Batch Processing: The first column in </span><span class="si">{}</span><span class="s1"> must contain time data.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fullFilePath</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">errorStr</span><span class="p">)</span>
                      
                        <span class="n">boolDataOK</span><span class="p">,</span> <span class="n">dataFailureReason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BatchProcessingCheckAllInputDataPresent</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">boolDataOK</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failureReason</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">join</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span>
                            <span class="n">failureReason</span> <span class="o">=</span> <span class="n">failureReason</span> <span class="o">+</span> <span class="n">join</span> <span class="o">+</span> <span class="n">dataFailureReason</span>
                            <span class="n">boolFileFormatOK</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="k">if</span> <span class="n">boolFileFormatOK</span><span class="p">:</span>
                        <span class="c1"># Column headers form the keys in the dictionary called self.signalData</span>
                        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                                <span class="n">header</span> <span class="o">=</span><span class="s1">&#39;time&#39;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">header</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">=</span><span class="p">[]</span>
                        <span class="c1"># Also add a &#39;model&#39; key to hold a list of concentrations generated by a model</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                        <span class="c1"># Each key in the dictionary is paired with a </span>
                        <span class="c1"># list of corresponding concentrations </span>
                        <span class="c1"># (except the Time key that is paired with a list of times)</span>
                        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">readCSV</span><span class="p">:</span>
                            <span class="n">colNum</span><span class="o">=</span><span class="mi">0</span>
                            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">:</span>
                                <span class="c1"># Iterate over columns in the selected row</span>
                                <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">colNum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                                        <span class="c1"># time column</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">colNum</span><span class="p">])</span><span class="o">/</span><span class="mf">60.0</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">signalData</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">colNum</span><span class="p">]))</span>
                                    <span class="n">colNum</span><span class="o">+=</span><span class="mi">1</span>           
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Batch Processing: CSV data file </span><span class="si">{}</span><span class="s1"> loaded OK&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fullFilePath</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NormaliseSignalData</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">boolFileFormatOK</span><span class="p">,</span> <span class="n">failureReason</span>
        
        <span class="k">except</span> <span class="n">csv</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
            <span class="n">boolFileFormatOK</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CSV Reader error in function FERRET BatchProcessingLoadDataFile: file </span><span class="si">{}</span><span class="s1">, line </span><span class="si">{}</span><span class="s1">: error=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span><span class="p">,</span> <span class="n">readCSV</span><span class="o">.</span><span class="n">line_num</span><span class="p">,</span> <span class="n">csv</span><span class="o">.</span><span class="n">Error</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;CSV Reader error in function FERRET BatchProcessingLoadDataFile: file </span><span class="si">{}</span><span class="s1">, line </span><span class="si">{}</span><span class="s1">: error =</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span><span class="p">,</span> <span class="n">readCSV</span><span class="o">.</span><span class="n">line_num</span><span class="p">,</span> <span class="n">csv</span><span class="o">.</span><span class="n">Error</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">boolFileFormatOK</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;IOError in function FERRET BatchProcessingLoadDataFile: cannot open file&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span> <span class="o">+</span> <span class="s1">&#39; or read its data&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span> <span class="p">(</span><span class="s1">&#39;IOError in function FERRET BatchProcessingLoadDataFile: cannot open file&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFileName</span> <span class="o">+</span> <span class="s1">&#39; or read its data&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">re</span><span class="p">:</span>
            <span class="n">boolFileFormatOK</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Runtime error in function FERRET BatchProcessingLoadDataFile: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Runtime error in function FERRET BatchProcessingLoadDataFile: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">re</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">boolFileFormatOK</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET BatchProcessingLoadDataFile: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; at line </span><span class="si">{}</span><span class="s1"> in the CSV file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">readCSV</span><span class="o">.</span><span class="n">line_num</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET BatchProcessingLoadDataFile: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; at line </span><span class="si">{}</span><span class="s1"> in the CSV file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">readCSV</span><span class="o">.</span><span class="n">line_num</span><span class="p">))</span>
            <span class="n">failureReason</span> <span class="o">=</span> <span class="s2">&quot;Error reading CSV file at line </span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">readCSV</span><span class="o">.</span><span class="n">line_num</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggleEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">boolFileFormatOK</span><span class="p">,</span> <span class="n">failureReason</span> </div>


<div class="viewcode-block" id="Ferret.BatchProcessingCheckAllInputDataPresent"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.BatchProcessingCheckAllInputDataPresent">[docs]</a>    <span class="k">def</span> <span class="nf">BatchProcessingCheckAllInputDataPresent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function checks that the current data file contains</span>
<span class="sd">        data for the ROI, AIF and, if appropriate, the VIF.</span>
<span class="sd">        </span>
<span class="sd">        If data is missing, it returns false and a string indicating </span>
<span class="sd">        what data is missing.</span>

<span class="sd">        Input</span>
<span class="sd">        -----</span>
<span class="sd">        headers - A list of the column headers in the MR signal</span>
<span class="sd">            CSV data file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">boolDataOK</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">join</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">failureReason</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lowerCaseHeaders</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">]</span>

            <span class="c1"># Check ROI data is in the current data file</span>
            <span class="n">ROI</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbROI</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">ROI</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">lowerCaseHeaders</span><span class="p">):</span>
                <span class="n">boolDataOK</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">failureReason</span> <span class="o">=</span> <span class="n">ROI</span> <span class="o">+</span> <span class="s2">&quot; data missing&quot;</span>
            
            <span class="c1"># Check AIF data is in the current data file</span>
            <span class="n">AIF</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbAIF</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">AIF</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">lowerCaseHeaders</span><span class="p">):</span>
                <span class="n">boolDataOK</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failureReason</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">join</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span>
                <span class="n">failureReason</span> <span class="o">=</span> <span class="n">failureReason</span> <span class="o">+</span> <span class="n">join</span> <span class="o">+</span> <span class="n">AIF</span> <span class="o">+</span> <span class="s2">&quot; data missing&quot;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
                <span class="c1"># Check VIF data is in the current data file</span>
                <span class="n">VIF</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbVIF</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">VIF</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">lowerCaseHeaders</span><span class="p">):</span>
                    <span class="n">boolDataOK</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failureReason</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">join</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span>
                    <span class="n">failureReason</span> <span class="o">=</span> <span class="n">failureReason</span> <span class="o">+</span> <span class="n">join</span> <span class="o">+</span> <span class="n">VIF</span> <span class="o">+</span> <span class="s2">&quot; data missing&quot;</span>
            
            <span class="k">return</span> <span class="n">boolDataOK</span><span class="p">,</span> <span class="n">failureReason</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">boolDataOK</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET BatchProcessingCheckAllInputDataPresent: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET BatchProcessingCheckAllInputDataPresent: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">failureReason</span> <span class="o">=</span> <span class="n">failureReason</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">boolDataOK</span><span class="p">,</span> <span class="n">failureReason</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggleEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ferret.BatchProcessingHaveParamsChanged"><a class="viewcode-back" href="../../../Developer.FERRET.html#Developer.FERRET.Ferret.Ferret.BatchProcessingHaveParamsChanged">[docs]</a>    <span class="k">def</span> <span class="nf">BatchProcessingHaveParamsChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns True if the user has changed one or more  </span>
<span class="sd">        parameter spinbox values from the defaults&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">boolParameterChanged</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">modelName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmbModels</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;function FERRET BatchProcessingHaveParamsChanged called when model = &#39;</span> <span class="o">+</span> <span class="n">modelName</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter1</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter1</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">!=</span> 
                   <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getParameterDefault</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
                    <span class="n">boolParameterChanged</span> <span class="o">=</span> <span class="kc">True</span>
           
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter2</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter2</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">!=</span> 
                   <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getParameterDefault</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">2</span><span class="p">)):</span>
                    <span class="n">boolParameterChanged</span> <span class="o">=</span> <span class="kc">True</span>
                    
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter3</span><span class="o">.</span><span class="n">isVisible</span><span class="p">()</span> <span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter3</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">!=</span> 
                   <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getParameterDefault</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span><span class="mi">3</span><span class="p">)):</span>
                    <span class="n">boolParameterChanged</span> <span class="o">=</span> <span class="kc">True</span>  
                    
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter4</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter4</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">!=</span> 
                   <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getParameterDefault</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span>
                    <span class="n">boolParameterChanged</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter5</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spinBoxParameter5</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">!=</span> 
                   <span class="bp">self</span><span class="o">.</span><span class="n">objXMLReader</span><span class="o">.</span><span class="n">getParameterDefault</span><span class="p">(</span><span class="n">modelName</span><span class="p">,</span> <span class="mi">5</span><span class="p">)):</span>
                    <span class="n">boolParameterChanged</span> <span class="o">=</span> <span class="kc">True</span>
            
            <span class="k">return</span> <span class="n">boolParameterChanged</span>    
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET BatchProcessingHaveParamsChanged: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error in function FERRET BatchProcessingHaveParamsChanged: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggleEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div></div>
            
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Steve Shillitoe and Joao Sousa

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>